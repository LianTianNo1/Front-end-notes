(window.webpackJsonp=window.webpackJsonp||[]).push([[34],{584:function(t,s,a){"use strict";a.r(s);var n=a(13),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"小浪复习node-js-express-koa2-egg"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#小浪复习node-js-express-koa2-egg"}},[t._v("#")]),t._v(" 小浪复习Node.js+express+koa2+egg")]),t._v(" "),a("h2",{attrs:{id:"node原生"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#node原生"}},[t._v("#")]),t._v(" Node原生")]),t._v(" "),a("h3",{attrs:{id:"node原生搭建服务"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#node原生搭建服务"}},[t._v("#")]),t._v(" Node原生搭建服务")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 1. 引入 http 模块")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" http "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'http'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 2. 用 http 模块创建服务")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n * req 获取 url 信息 (request)\n * res 浏览器返回响应信息 (response)\n */")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" server "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" http"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("createServer")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\nserver"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("on")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'request'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("req"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" res")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" method "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" req"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("method"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("toLowerCase")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" url "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" path"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("url\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" path "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" url"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("split")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'?'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" params "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" url"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("split")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'?'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("path "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/login'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// console.log(’处理登录请求'，params) ;")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 1.告诉客户端返回的数据是什么类型")]),t._v("\n    res"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("writeHead")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("200")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//’Content-Type' :’ text/plain; charset=utf-8;’")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v("'Content-Type'")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'application/ json '")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 2.告诉客户端返回的数据是什么")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// res. end(’www. it666. com知播渔’) ;")]),t._v("\n    res"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("end")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("JSON")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("stringify")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("' lnj'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("age")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("33")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("path "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/register'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("method "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'get'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'处理get请求'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'处理post请求'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  res"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("writeHead")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("200")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v("'Content-Type'")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'text/html;charset=UTF-8'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 往页面打印值")]),t._v("\n  res"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("write")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'<h1 style=\"text-align:center\">Hello NodeJS</h1>'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 结束响应")]),t._v("\n  res"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("end")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 设置 HTTP 头部，状态码是 200，文件类型是 html，字符集是 utf8")]),t._v("\n\nserver"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("listen")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3000")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 监听的端口")]),t._v("\n\n")])])]),a("h4",{attrs:{id:"_1-告诉客户端返回的数据是什么类型"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-告诉客户端返回的数据是什么类型"}},[t._v("#")]),t._v(" 1.告诉客户端返回的数据是什么类型")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("res"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("writeHead")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("200")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//’Content-Type' :’ text/plain; charset=utf-8;’")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v("'Content-Type'")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'application/ json '")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("p",[a("strong",[t._v("注意")]),t._v(" "),a("code",[t._v("text/plain; charset=utf-8;")]),t._v("文本类型要指定返回的数据类型")]),t._v(" "),a("h4",{attrs:{id:"_2-如何返回静态资源"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-如何返回静态资源"}},[t._v("#")]),t._v(" 2.如何返回静态资源")]),t._v(" "),a("p",[t._v("写个"),a("code",[t._v("staticSeriver.js")])]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220217213906.png",alt:"image-20220217213904915"}})]),t._v(" "),a("h4",{attrs:{id:"_3-返回动态资源"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-返回动态资源"}},[t._v("#")]),t._v(" 3.返回动态资源")]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220217214023.png",alt:"image-20220217214022266"}})]),t._v(" "),a("p",[t._v("写个"),a("code",[t._v("dynamicServer.js")])]),t._v(" "),a("blockquote",[a("p",[t._v("安装"),a("strong",[t._v("ejs")])])]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("npm")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" ejs\n")])])]),a("p",[t._v("继续写"),a("code",[t._v("dynamicServer.js")])]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220217214243.png",alt:"image-20220217214241983"}})]),t._v(" "),a("h4",{attrs:{id:"_4-梳理下结构"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-梳理下结构"}},[t._v("#")]),t._v(" 4.梳理下结构")]),t._v(" "),a("h5",{attrs:{id:"配置文件-端口明显"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#配置文件-端口明显"}},[t._v("#")]),t._v(" 配置文件，端口明显")]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220217215235.png",alt:"image-20220217215233197"}})]),t._v(" "),a("h5",{attrs:{id:"处理各种请求"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#处理各种请求"}},[t._v("#")]),t._v(" 处理各种请求")]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220217215239.png",alt:"image-20220217215052493"}})]),t._v(" "),a("h5",{attrs:{id:"处理路由"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#处理路由"}},[t._v("#")]),t._v(" 处理路由")]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220217215521.png",alt:"image-20220217215519620"}})]),t._v(" "),a("blockquote",[a("p",[t._v("处理商品")])]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220217215657.png",alt:"image-20220217215655585"}})]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220217220536.png",alt:"image-20220217220530767"}})]),t._v(" "),a("blockquote",[a("p",[t._v("处理用户")])]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220217220101.png",alt:"image-20220217220100725"}})]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220217220434.png",alt:"image-20220217220423808"}})]),t._v(" "),a("blockquote",[a("p",[t._v("在核心app.js文件添加核心逻辑")])]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220217220244.png",alt:"image-20220217220242933"}})]),t._v(" "),a("h5",{attrs:{id:"处理返回的信息"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#处理返回的信息"}},[t._v("#")]),t._v(" 处理返回的信息")]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220217220737.png",alt:"image-20220217220736243"}})]),t._v(" "),a("h4",{attrs:{id:"_5-密码加密"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-密码加密"}},[t._v("#")]),t._v(" 5.密码加密")]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220217221518.png",alt:"image-20220217221517366"}})]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220217221604.png",alt:"image-20220217221603390"}})]),t._v(" "),a("blockquote",[a("p",[t._v("加盐")])]),t._v(" "),a("img",{staticStyle:{zoom:"67%"},attrs:{src:"小浪复习Node.js+express+koa2+egg学习.assets/image-20220217221655715.png",alt:"image-20220217221655715"}}),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220217222149.png",alt:"image-20220217222148457"}})]),t._v(" "),a("blockquote",[a("p",[t._v("注册的时候存入加密的密码")])]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220217222325.png",alt:"image-20220217222324321"}})]),t._v(" "),a("p",[a("strong",[t._v("注意")]),t._v("：加密之后再查询。用于登录")]),t._v(" "),a("h4",{attrs:{id:"_6-客户端保存登录状态"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6-客户端保存登录状态"}},[t._v("#")]),t._v(" 6.客户端保存登录状态")]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220217222705.png",alt:"image-20220217222704810"}})]),t._v(" "),a("blockquote",[a("p",[t._v("服务端设置cookie")])]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220217222947.png",alt:"image-20220217222945469"}})]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220217223027.png",alt:"image-20220217223026553"}})]),t._v(" "),a("blockquote",[a("p",[t._v("设置过期时间")])]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220217223228.png",alt:"image-20220217223226975"}})]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220217223235.png",alt:"image-20220217223234693"}})]),t._v(" "),a("blockquote",[a("p",[t._v("不能设置为明文，设置加密，使用我们之前用来加密密码的方法")])]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220217223359.png",alt:"image-20220217223358104"}})]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220217223518.png",alt:"image-20220217223516647"}})]),t._v(" "),a("h4",{attrs:{id:"_7-服务端保存用户登录状态"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_7-服务端保存用户登录状态"}},[t._v("#")]),t._v(" 7.服务端保存用户登录状态")]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220217223637.png",alt:"image-20220217223636588"}})]),t._v(" "),a("blockquote",[a("p",[t._v("在登录的时候解析cookie")])]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220217223825.png",alt:"image-20220217223824281"}})]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220217224145.png",alt:"image-20220217224143141"}})]),t._v(" "),a("blockquote",[a("p",[t._v("判断用户标识，没有设置Cookie")])]),t._v(" "),a("p",[t._v("userID作为标识")]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220217224057.png",alt:"image-20220217224056156"}})]),t._v(" "),a("blockquote",[a("p",[t._v("写成一个方法")])]),t._v(" "),a("p",[t._v("根据userID为每个用户设置一个容器")]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220217224652.png",alt:"image-20220217224651315"}})]),t._v(" "),a("p",[t._v("在登录的时装进去，为用户的容器里存储数据")]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220217224908.png",alt:"image-20220217224907637"}})]),t._v(" "),a("p",[t._v("这样就在res.session中了")]),t._v(" "),a("p",[t._v("只要 SESSION_CONTAINER 不是 null，那么这个永远存在，"),a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220217225232.png",alt:"image-20220217225230601"}})]),t._v(" "),a("h5",{attrs:{id:"存在问题"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#存在问题"}},[t._v("#")]),t._v(" 存在问题")]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220217225319.png",alt:"image-20220217225317915"}})]),t._v(" "),a("h5",{attrs:{id:"使用redis"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#使用redis"}},[t._v("#")]),t._v(" 使用Redis")]),t._v(" "),a("img",{staticStyle:{zoom:"67%"},attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220217225351.png",alt:"image-20220217225350243"}}),t._v(" "),a("h4",{attrs:{id:"_8-redis"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_8-redis"}},[t._v("#")]),t._v(" 8.Redis")]),t._v(" "),a("h5",{attrs:{id:"数据库配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#数据库配置"}},[t._v("#")]),t._v(" 数据库配置")]),t._v(" "),a("h6",{attrs:{id:"根据不同的环境变量使用不同的数据库"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#根据不同的环境变量使用不同的数据库"}},[t._v("#")]),t._v(" 根据不同的环境变量使用不同的数据库")]),t._v(" "),a("blockquote",[a("p",[t._v("创建一个mysql的db.js")])]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220214202823.png",alt:"image-20220214202820737"}})]),t._v(" "),a("p",[t._v("然后暴露出去")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("module"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("MYSQL_CONFIG")]),t._v("\n")])])]),a("h6",{attrs:{id:"封装数据库操作"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#封装数据库操作"}},[t._v("#")]),t._v(" 封装数据库操作")]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220214203246.png",alt:"image-20220214203244162"}})]),t._v(" "),a("p",[t._v("然后暴露出去")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("module"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" exc\n")])])]),a("h5",{attrs:{id:"安装redis"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装redis"}},[t._v("#")]),t._v(" 安装Redis")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("npm")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" redis\n")])])]),a("h5",{attrs:{id:"在之前db-js配置文件添加redis开发阶段和上线阶段的不同的配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#在之前db-js配置文件添加redis开发阶段和上线阶段的不同的配置"}},[t._v("#")]),t._v(" 在之前db.js配置文件添加"),a("code",[t._v("redis")]),t._v("开发阶段和上线阶段的不同的配置")]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220218085005.png",alt:"image-20220218085004123"}})]),t._v(" "),a("h5",{attrs:{id:"封装redis-js"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#封装redis-js"}},[t._v("#")]),t._v(" 封装Redis.js")]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220218085711.png",alt:"image-20220218085709850"}})]),t._v(" "),a("p",[t._v("然后注释掉容器导入时redis,把之前的容器都用redis替换")]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220218090024.png",alt:"image-20220218090023438"}})]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220218090313.png",alt:"image-20220218090312548"}})]),t._v(" "),a("blockquote",[a("p",[t._v("登录的时候把信息添加到redis中")])]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220218090536.png",alt:"image-20220218090535011"}})]),t._v(" "),a("blockquote",[a("p",[t._v("然后就是上面的下次在来就去redis获取")])]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220218090650.png",alt:"image-20220218090648888"}})]),t._v(" "),a("h4",{attrs:{id:"_9-sequelize"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_9-sequelize"}},[t._v("#")]),t._v(" 9.sequelize")]),t._v(" "),a("p",[t._v("Sequelize的调用突出一个简单快捷。具体情况可以感受一下下面的代码。如果有过开发经验的可以略过。")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('Table1.findById(23);\n//select a,b,c,d from table1 where id=23;\n\nTable1.findAll({\n\twhere:{a:"test",b:76}\n});\n//select a,b,c,d from table1 where a="test" and "b=76;\n复制代码\n')])])]),a("p",[t._v("在单表查询的时候只需要简单的配置即可完成查询。是不是非常的简单方便呢？")]),t._v(" "),a("blockquote",[a("h5",{attrs:{id:"连接数据库"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#连接数据库"}},[t._v("#")]),t._v(" 连接数据库")])]),t._v(" "),a("p",[t._v("Sequelize的连接需要传入参数，并且可以配置开启线程池、读写分库等操作。")]),t._v(" "),a("p",[t._v("简单的写法是这样的:"),a("code",[t._v('new Sequelize("表名","用户名","密码",配置)')])]),t._v(" "),a("p",[t._v("正常使用中很少使用到所有的参数，这里提供一个常用的模板，只需要修改自己使用的值即可。")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("const sequelize = new Sequelize('database', 'username', 'password',  {\n  host: 'localhost',    //数据库地址,默认本机\n  port:'3306',\n  dialect: 'mysql',\n  pool: {   //连接池设置\n    max: 5, //最大连接数\n    min: 0, //最小连接数\n    idle: 10000\n  },\n });\n复制代码\n")])])]),a("p",[t._v("下面是详细的配置参数。")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("const sequelize = new Sequelize('database', 'username', 'password', {\n  // 数据库类型，支持: 'mysql', 'sqlite', 'postgres', 'mssql'\n  dialect: 'mysql',\n  // 自定义链接地址，可以是ip或者域名，默认本机：localhost\n  host: 'my.server.tld',\n  // 自定义端口，默认3306\n  port: 12345,\n  // postgres使用的参数,连接类型，默认：tcp\n  protocol: null,\n  // 是否开始日志，默认是用console.log\n  // 建议开启，方便对照生成的sql语句\n  logging: true,\n  // 默认是空\n  // 支持: 'mysql', 'postgres', 'mssql'\n  dialectOptions: {\n    socketPath: '/Applications/MAMP/tmp/mysql/mysql.sock',\n    supportBigNumbers: true,\n    bigNumberStrings: true\n  },\n  // sqlite的存储位置,仅sqlite有用\n  // - 默认 ':memory:'\n  storage: 'path/to/database.sqlite',\n\n  // 是否将undefined转化为NULL\n  // - 默认: false\n  omitNull: true,\n  // pg中开启ssl支持\n  // - 默认: false\n  native: true,\n  // 数据库默认参数,全局参数\n  define: {\n    underscored: false\n    freezeTableName: false,\n    charset: 'utf8',\n    dialectOptions: {\n      collate: 'utf8_general_ci'\n    },\n    timestamps: true\n  },\n  // 是否同步\n  sync: { force: true },\n  // 连接池配置\n  pool: {\n    max: 5,\n    idle: 30000,\n    acquire: 60000,\n  },\n  isolationLevel: Transaction.ISOLATION_LEVELS.REPEATABLE_READ\n})\n复制代码\n")])])]),a("blockquote",[a("h2",{attrs:{id:"定义模型对象"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#定义模型对象"}},[t._v("#")]),t._v(" 定义模型对象")])]),t._v(" "),a("p",[t._v("在使用之前一定要先创建模型对象。就是数据库中表的名称、使用到的字段、字段类型等。")]),t._v(" "),a("p",[t._v("这里有一个推荐的开发方式。先在nodejs中将对象创建出来，然后调用Sequelize的同步方法，将数据库自动创建出来。这样就避免了既要写代码建表，又要手工创建数据库中的表的操作。只需要单独考虑代码中的对象类型等属性就好了。")]),t._v(" "),a("p",[t._v("如果数据库中已经建好了表，并且不能删除，这个时候就不能自动创建了，因为创建的时候会删除掉旧的数据。")]),t._v(" "),a("p",[t._v("下面是简单的对象创建多数情况下这样就可以了。")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("const users = db.define('t_user'/*自定义表名*/, {\n    id: {\n        type: Sequelize.INTEGER,\n        primaryKey: true,       //主键\n        autoIncrement: true,    //自增\n        comment: \"自增id\"       //注释:只在代码中有效\n    },\n    //用户名\n    username: {\n        type: Sequelize.STRING,\n        validate:{\n\t        isEmail: true,   //类型检测,是否是邮箱格式\n        }\n    },\n    //密码\n    pwd: {\n        type: Sequelize.STRING(10),\n        allowNull: false,//不允许为null\n    },\n    //状态\n    status: {\n        type: Sequelize.INTEGER,\n         defaultValue: 0,//默认值是0\n    },\n    //昵称\n    nickname: {\n        type: Sequelize.STRING\n    },\n    //token\n    token: {\n        type: Sequelize.UUID\n    },\n    create_time: {\n        type: Sequelize.DATE,\n        defaultValue: Sequelize.NOW\n    }\n}, {\n    //使用自定义表名\n    freezeTableName: true,\n    //去掉默认的添加时间和更新时间\n    timestamps: false,\n    indexes:[\n\t    //普通索引,默认BTREE\n        {\n            unique: true,\n            fields: ['pid']\n        },\n     ]\n});\n\n//同步:没有就新建,有就不变\n// users.sync();\n//先删除后同步\nusers.sync({\n    force: true\n});\n复制代码\n")])])]),a("blockquote",[a("h2",{attrs:{id:"数据类型"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#数据类型"}},[t._v("#")]),t._v(" 数据类型")])]),t._v(" "),a("p",[t._v("前段将了对象的创建，里面用到了对象的各种类型。这里再介绍一下类型的具体使用方式。")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("Sequelize.STRING \t\t//字符串,长度默认255,VARCHAR(255)\nSequelize.STRING(1234)  //设定长度的字符串,VARCHAR(1234)\nSequelize.STRING.BINARY   //定义类型VARCHAR BINARY\nSequelize.TEXT           //长字符串,文本 TEXT\nSequelize.TEXT('tiny')   //小文本字符串,TINYTEXT\n\nSequelize.INTEGER      //int数字,int\nSequelize.BIGINT       //更大的数字,BIGINT\nSequelize.BIGINT(11)   //设定长度的数字,BIGINT(11)\n\nSequelize.FLOAT        //浮点类型,FLOAT\nSequelize.FLOAT(11)     //设定长度的浮点,FLOAT(11)\nSequelize.FLOAT(11, 12)  //设定长度和小数位数的浮点,FLOAT(11,12)\n\nSequelize.REAL     //REAL  PostgreSQL only.\nSequelize.REAL(11) // REAL(11)    PostgreSQL only.\nSequelize.REAL(11, 12)  // REAL(11,12) PostgreSQL only.\n\nSequelize.DOUBLE     // DOUBLE\nSequelize.DOUBLE(11)  // DOUBLE(11)\nSequelize.DOUBLE(11, 12) // DOUBLE(11,12)\n\nSequelize.DECIMAL     // DECIMAL\nSequelize.DECIMAL(10, 2)  // DECIMAL(10,2)\n\nSequelize.DATE    // 日期类型,DATETIME for mysql / sqlite, TIMESTAMP WITH TIME ZONE for postgres\nSequelize.DATE(6) // mysql 5.6.4+支持,分秒精度为6位\nSequelize.DATEONLY   // 仅日期部分\nSequelize.BOOLEAN   // int类型,长度为1,TINYINT(1)\n\nSequelize.ENUM('value 1', 'value 2')  // 枚举类型\nSequelize.ARRAY(Sequelize.TEXT)  //PostgreSQL only.\nSequelize.ARRAY(Sequelize.ENUM)  //  PostgreSQL only.\n\nSequelize.JSON   // JSON column. PostgreSQL, SQLite and MySQL only.\nSequelize.JSONB  // JSONB column. PostgreSQL only.\n\nSequelize.BLOB   // BLOB (bytea for PostgreSQL)\nSequelize.BLOB('tiny')  // TINYBLOB (bytea for PostgreSQL. Other options are medium and long)\n\nSequelize.UUID  // PostgreSQL和SQLite的数据类型是UUID, MySQL是CHAR(36)类型\n\nSequelize.CIDR  // PostgreSQL中的CIDR类型\nSequelize.INET   // PostgreSQL中的INET类型\nSequelize.MACADDR  // PostgreSQL中的MACADDR类型\n\nSequelize.RANGE(Sequelize.INTEGER)    //PostgreSQL only.\nSequelize.RANGE(Sequelize.BIGINT)     // PostgreSQL only.\nSequelize.RANGE(Sequelize.DATE)       //PostgreSQL only.\nSequelize.RANGE(Sequelize.DATEONLY)   //PostgreSQL only.\nSequelize.RANGE(Sequelize.DECIMAL)    //PostgreSQL only.\n\nSequelize.ARRAY(Sequelize.RANGE(Sequelize.DATE)) // PostgreSQL only.\n\nSequelize.GEOMETRY   //PostgreSQL (with PostGIS) or MySQL only.\nSequelize.GEOMETRY('POINT')  // PostgreSQL (with PostGIS) or MySQL only.\nSequelize.GEOMETRY('POINT', 4326)// PostgreSQL (with PostGIS) or MySQL only.\n复制代码\n")])])]),a("blockquote",[a("h2",{attrs:{id:"数据类型检测"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#数据类型检测"}},[t._v("#")]),t._v(" 数据类型检测")])]),t._v(" "),a("p",[t._v("上面可以看到使用validate字段去验证字段的值是否符合标准，这样就可以在入库之前就能知道数据是否符合规则。否则贸然将陌生的数据存入数据库就好像将陌生人带到家里一样，是否安全全靠缘分啊。")]),t._v(" "),a("p",[t._v("Sequelize内置支持的验证还是非常的多的，如果这些都不满意，还可以自己定义一个。")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("validate: {\n    is: [\"^[a-z]+$\",'i'],     // 全匹配字母\n    is: /^[a-z]+$/i,          // 全匹配字母，用规则表达式写法\n    not: [\"[a-z]\",'i'],       // 不能包含字母\n    isEmail: true,            // 检查邮件格式\n    isUrl: true,              // 是否是合法网址\n    isIP: true,               // 是否是合法IP地址\n    isIPv4: true,             // 是否是合法IPv4地址\n    isIPv6: true,             // 是否是合法IPv6地址\n    isAlpha: true,            // 是否是字母\n    isAlphanumeric: true,     // 是否是数字和字母\n    isNumeric: true,          // 只允许数字\n    isInt: true,              // 只允许整数\n    isFloat: true,            // 是否是浮点数\n    isDecimal: true,          // 是否是十进制书\n    isLowercase: true,        // 是否是小写\n    isUppercase: true,        // 是否大写\n    notNull: true,            // 不允许为null\n    isNull: true,             // 是否是null\n    notEmpty: true,           // 不允许为空\n    equals: 'specific value', // 等于某些值\n    contains: 'foo',          // 包含某些字符\n    notIn: [['foo', 'bar']],  // 不在列表中\n    isIn: [['foo', 'bar']],   // 在列表中\n    notContains: 'bar',       // 不包含\n    len: [2,10],              // 长度范围\n    isUUID: 4,                // 是否是合法 uuids\n    isDate: true,             // 是否是有效日期\n    isAfter: \"2011-11-05\",    // 是否晚于某个日期\n    isBefore: \"2011-11-05\",   // 是否早于某个日期\n    max: 23,                  // 最大值\n    min: 23,                  // 最小值\n    isArray: true,            // 是否是数组\n    isCreditCard: true,       // 是否是有效信用卡号\n    // 自定义规则\n    isEven: function(value) {\n    if(parseInt(value) % 2 != 0) {\n        throw new Error('请输入偶数!')\n    }\n}\n复制代码\n")])])]),a("blockquote",[a("h2",{attrs:{id:"api略讲"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#api略讲"}},[t._v("#")]),t._v(" API略讲")])]),t._v(" "),a("p",[t._v("Sequelize的API基本覆盖了常用的使用方式，其中单表查询常用的有一下几种。复杂的可以参考更多的API。")]),t._v(" "),a("blockquote",[a("h3",{attrs:{id:"查询多条-findall-opts-或者-all-opts"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#查询多条-findall-opts-或者-all-opts"}},[t._v("#")]),t._v(" 查询多条 findAll(opts) 或者 all(opts)")])]),t._v(" "),a("p",[t._v("查询用的参数普遍通用，只有部分API的有特殊参数。这里展示一次常用参数，下面就略过了。")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('let list = await model.findAll({\n\twhere:{\n\t\tid:{$gt:10},//id大于10的\n\t\tname:"test"  //name等于test\n\t},\n\torder:[\n\t\t"id",   //根据id排序\n\t\t["id","desc"]//根据id倒序\n\t],\n\tlimit:10,//返回个数\n\toffset:20,//起始位置,跳过数量\n\tattributes:["attr1","attr2"], //返回的字段\n});\n//select attr1,attr2 from model where ......\n复制代码\n')])])]),a("blockquote",[a("h3",{attrs:{id:"通过id查询-findbyid-id-opts"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#通过id查询-findbyid-id-opts"}},[t._v("#")]),t._v(" 通过id查询 findById(id,opts)")])]),t._v(" "),a("p",[t._v("这里默认数据的主键是id，查询的时候直接通过id查询数据。这里推荐在新建数据库的时候可以添加id作为唯一主键。")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("let model = await model.findById(12);\n//select a,b,c from model where id=12;\n复制代码\n")])])]),a("blockquote",[a("h3",{attrs:{id:"查询一条记录-findone-opts"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#查询一条记录-findone-opts"}},[t._v("#")]),t._v(" 查询一条记录 findOne(opts)")])]),t._v(" "),a("p",[t._v("根据条件查询记录，这里的条件一定要填写，不然就是返回第一条数据了。")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("let model = await model.findOne({\n\twhere:{id:12}\n});\n//select a,b,c from model where id=12;\n复制代码\n")])])]),a("blockquote",[a("h3",{attrs:{id:"分页查询-findandcount-opts-或者-findandcountall"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#分页查询-findandcount-opts-或者-findandcountall"}},[t._v("#")]),t._v(" 分页查询 findAndCount(opts) 或者 findAndCountAll")])]),t._v(" "),a("p",[t._v("分页查询恐怕是另外一个常用方法了。任何一个列表都有需要分页的时候。")]),t._v(" "),a("p",[t._v("这个方法会同时执行2跳语句。")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("let data = await model.findAndCount({\n\tlimit:10,//每页10条\n\toffset:0*10,//第x页*每页个数\n\twhere:{}\n});\nlet list = data.rows;\nlet count = data.count;\n//select count(*) from model where ...;\n//select a,b,c from model where .... limit 0,10;\n复制代码\n")])])]),a("blockquote",[a("h3",{attrs:{id:"添加新数据-create-model-opts"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#添加新数据-create-model-opts"}},[t._v("#")]),t._v(" 添加新数据 create(model,opts)")])]),t._v(" "),a("p",[t._v("添加就非常的自在了。简单的只需要传入model对象即可。这里要保证model对象的属性和字段名要一致。如果不一致就会出错。也可以传入配置参数来增加条件等。")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('let model= {\n\tname:"test",\n\ttoken:"adwadfv2324"\n}\n await model.create(model);\n//insert into model (name,token) values("test","adwadfv2324");\n复制代码\n')])])]),a("blockquote",[a("h3",{attrs:{id:"查询-不存在就返回默认对象-findorinitialize-opts"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#查询-不存在就返回默认对象-findorinitialize-opts"}},[t._v("#")]),t._v(" 查询,不存在就返回默认对象 findOrInitialize(opts)")])]),t._v(" "),a("p",[t._v("opts.default 默认值对象")]),t._v(" "),a("p",[t._v("这个方法首先会查询数据库，如果没有结果就会返回参数中的default对象。这个比较适合返回默认对象之类的场景。")]),t._v(" "),a("blockquote",[a("h3",{attrs:{id:"查询-不存在就新建一个-findorcreate-opts-或者findcreatefind"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#查询-不存在就新建一个-findorcreate-opts-或者findcreatefind"}},[t._v("#")]),t._v(" 查询,不存在就新建一个 findOrCreate(opts)或者findCreateFind")])]),t._v(" "),a("p",[t._v("这个方法用到的情况也比较多。通常用于自动创建不存在的数据。直接就返回了默认值。")]),t._v(" "),a("blockquote",[a("h3",{attrs:{id:"有则更新-无则添加-upsert-model-opts-或者-insertorupdate-model-opts"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#有则更新-无则添加-upsert-model-opts-或者-insertorupdate-model-opts"}},[t._v("#")]),t._v(" 有则更新,无则添加 upsert(model,opts) 或者 insertOrUpdate(model,opts)")])]),t._v(" "),a("p",[t._v("根据主键或者唯一约束键匹配")]),t._v(" "),a("p",[t._v("常用于编辑的时候添加或者更新统一操作。")]),t._v(" "),a("blockquote",[a("h3",{attrs:{id:"更新记录-update-model-opts"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#更新记录-update-model-opts"}},[t._v("#")]),t._v(" 更新记录 update(model,opts)")])]),t._v(" "),a("p",[t._v("就是最常用的更新方法，可以传入要更新的model对象，同时用配置参数有条件的区别要更新的对象。")]),t._v(" "),a("blockquote",[a("h3",{attrs:{id:"删除记录-destroy-opts"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#删除记录-destroy-opts"}},[t._v("#")]),t._v(" 删除记录 destroy(opts)")])]),t._v(" "),a("p",[t._v("删除有2种情况，一种是物理删除。删除就从表中不存在了。另外一种就是设置paranoid，这个是虚拟删除，默认一个字段表示数据是否删除，查询的时候去掉这个条件即可查询到删除的数据。")]),t._v(" "),a("blockquote",[a("h3",{attrs:{id:"恢复记录-restore-opts"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#恢复记录-restore-opts"}},[t._v("#")]),t._v(" 恢复记录 restore(opts)")])]),t._v(" "),a("p",[t._v("恢复多个实例，当启用paranoid时就可以使用这个方法将曾今删除的数据恢复了。")]),t._v(" "),a("blockquote",[a("h3",{attrs:{id:"其他常用api"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#其他常用api"}},[t._v("#")]),t._v(" 其他常用API")])]),t._v(" "),a("ol",[a("li",[t._v('指定字段查询最大值 max("id",opts)')]),t._v(" "),a("li",[t._v('指定字段查询最小值 min("id",opts)')]),t._v(" "),a("li",[t._v('求和 sum("id",opts)')]),t._v(" "),a("li",[t._v("批量添加 bulkCreate([model],opts)")]),t._v(" "),a("li",[t._v("查表结构的信息 describe()")]),t._v(" "),a("li",[t._v('递增 increment("id",{by:1})')]),t._v(" "),a("li",[t._v('递减 decrement("id",{by:1})')]),t._v(" "),a("li",[t._v("统计查询个数 count(opts)")])]),t._v(" "),a("blockquote",[a("h2",{attrs:{id:"事务"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#事务"}},[t._v("#")]),t._v(" 事务")])]),t._v(" "),a("p",[t._v("Sequelize中的事务比较简单。但是如果有多个事务的话写出来的代码会非常的难看。这也算是Sequelize优化的比较差的地方了。")]),t._v(" "),a("p",[t._v("需要记得transaction参数要一致传递就可以了。其他就是一个正常的Promise调用。")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("//调用Sequelize初始化之后的sequelize对象\nreturn sequelize.transaction(function (t) {\n\t//返回最终的Promise\n  return User.create({\n    firstName: 'Abraham',\n    lastName: 'Lincoln'\n  }, {transaction: t}).then(function (user) {\n    return user.setShooter({\n      firstName: 'John',\n      lastName: 'Boothe'\n    }, {transaction: t});\n  });\n}).then(function (result) {\n  //主动调用commit提交结果\n  return t.commit();\n}).catch(function (err) {\n  //主动回滚操作\n  return t.rollback();\n});\n复制代码\n")])])]),a("blockquote",[a("h2",{attrs:{id:"多表联查"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#多表联查"}},[t._v("#")]),t._v(" 多表联查")])]),t._v(" "),a("p",[t._v("外键可能算是Sequelize中的一个难点了。这里涉及的东西稍微多一点，我们来慢慢捋一遍。")]),t._v(" "),a("blockquote",[a("h3",{attrs:{id:"外键知识点"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#外键知识点"}},[t._v("#")]),t._v(" 外键知识点")])]),t._v(" "),a("p",[t._v("外键的定制作用----三种约束模式：")]),t._v(" "),a("ol",[a("li",[t._v("district：严格模式(默认), 父表不能删除或更新一个被子表引用的记录。")]),t._v(" "),a("li",[t._v("cascade：级联模式, 父表操作后，子表关联的数据也跟着一起操作。也是Sequelize的默认模式。")]),t._v(" "),a("li",[t._v("set null：置空模式,前提外键字段允许为NLL,  父表操作后，子表对应的字段被置空。")])]),t._v(" "),a("blockquote",[a("h3",{attrs:{id:"使用外键的前提"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#使用外键的前提"}},[t._v("#")]),t._v(" 使用外键的前提")])]),t._v(" "),a("p",[t._v("在Sequelize中使用外键需要提前检查一下下面的这些选项，里面有一条出错就会导致设置失败。")]),t._v(" "),a("ol",[a("li",[t._v("表储存引擎必须是innodb，否则创建的外键无约束效果。")]),t._v(" "),a("li",[t._v("外键的列类型必须与父表的主键类型完全一致。")]),t._v(" "),a("li",[t._v("外键的名字不能重复。")]),t._v(" "),a("li",[t._v("已经存在数据的字段被设为外键时，必须保证字段中的数据与父表的主键数据对应起来。")])]),t._v(" "),a("blockquote",[a("h3",{attrs:{id:"使用示例-默认"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#使用示例-默认"}},[t._v("#")]),t._v(" 使用示例---默认")])]),t._v(" "),a("p",[t._v("默认情况下，主键使用的是主表的id字段，外键是使用的按照table+字段的方式建立的外键。一般情况下需要手动指定。")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('//主表指定关系\n test1.hasMany(test2, {\n     foreignKey: "pid",//外键名称\n });\n //子表指定关系\n test2.belongsTo(test1, {\n     foreignKey: "pid",//外键名称\n });\n复制代码\n')])])]),a("p",[t._v("默认就会在子表中添加一条外键记录，指向的就是主表的id。一般情况下这样就能够满足正常的使用了。比如一个主表记录商品信息，一个子表记录多个评论消息。")]),t._v(" "),a("blockquote",[a("h3",{attrs:{id:"使用示例-自定义"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#使用示例-自定义"}},[t._v("#")]),t._v(" 使用示例---自定义")])]),t._v(" "),a("p",[t._v("如果主表使用的主键id并不能满足正常的使用，还可以指定某一个固定的字段作为主表中的约束关系。")]),t._v(" "),a("blockquote",[a("p",[t._v("tips：主表中如果不是使用id作为主要关系，自定义的字段必须添加索引等条件，作为依赖中的关系。")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v(' test1.hasMany(test2, {\n     foreignKey: "pid",//外键字段名\n     sourceKey: "pid",//主键字段名\n });\n test2.belongsTo(test1, {\n     foreignKey: "pid",//关联名\n     targetKey:"pid"//自定义外键字段\n });\n //等待主键建立成功再建立子表的外键关系\n setTimeout(() => {\n    test2.sync({\n        force: true\n    });\n}, 2500);\n复制代码\n')])])]),a("blockquote",[a("h3",{attrs:{id:"使用示例-伪关系"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#使用示例-伪关系"}},[t._v("#")]),t._v(" 使用示例---伪关系")])]),t._v(" "),a("p",[t._v("实际使用的时候我还是倾向于这种关系。即表中关系已定的情况下仅仅指定外键关系。同步的时候仅仅同步表内容，不同步这个外键关系。")]),t._v(" "),a("blockquote",[a("p",[t._v("真正的建立可以使用手动建表的时候添加。或者也可以在自动建表结束后异步再执行一次外键关系的添加。")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v(' test1.hasMany(test2, {\n     foreignKey: "pid",\n     sourceKey: "pid",\n     constraints: false //不同步建立外键关系\n });\n test2.belongsTo(test1, {\n     foreignKey: "pid",\n     targetKey:"pid",\n     constraints: false //不同步建立外键关系\n });\n复制代码\n')])])]),a("blockquote",[a("h2",{attrs:{id:"示例"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#示例"}},[t._v("#")]),t._v(" 示例")])]),t._v(" "),a("p",[t._v("实际的操作部分大家可以看github中的test.js。"),a("a",{attrs:{href:"https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fcuo9958%2Fsequelize-api",target:"_blank",rel:"noopener noreferrer"}},[t._v("github地址"),a("OutboundLink")],1)]),t._v(" "),a("blockquote",[a("h3",{attrs:{id:"单表操作"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#单表操作"}},[t._v("#")]),t._v(" 单表操作")])]),t._v(" "),a("p",[t._v("Sequelize在查询结果返回之后会返回一个它自定义的对象。这个对象是支持继续操作的，其中具体的值存放在datavalues中。不过可以放心的是在转化为字符串的时候是不会带有任何Sequelize的属性的。")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('//根据条件查询一条数据\nlet model = await test1.findOne({\n\twhere:{\n\t\tid:5,\n\t\tname:"test"\n\t}\n});\n//修改其中的name字段的值\nmodel.name="更新";\n//保存,会自动update数据库中的值\nmodel.save();\n复制代码\n')])])]),a("blockquote",[a("h3",{attrs:{id:"联查"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#联查"}},[t._v("#")]),t._v(" 联查")])]),t._v(" "),a("p",[t._v("正常的使用过程中很少会说只需要查询一个表就能结果问题的。这里再说一下2个表查询的时候是怎么使用的。")]),t._v(" "),a("p",[t._v("这里的查询默认已经做好了外键的的关系。不过在使用的时候不做也是可以的，就是在查询的时候性能稍微不好而已。")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('//查询主表list的数据\n//一条list中的数据对应多条item中的数据\n let data = await models.List.findAll({\n\t where:{id:5},//条件,这里jiashe只需查询一条\n     include: [{\n         model: models.Item,\n         as:"items",//返回的对象修改成一个固定的名称\n     }]\n });\n let list1=data[0];//返回的第一条数据就是要查询的数据\n let list2=list1.items;//返回子表数据,items是自定义的名称\n')])])]),a("blockquote",[a("p",[t._v("安装")])]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("npm")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" --save sequelize\n")])])]),a("p",[t._v("操作什么数据库要安装什么驱动，这里安装mysql")]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220218091405.png",alt:"image-20220218091403707"}})]),t._v(" "),a("blockquote",[a("p",[t._v("在db.js中把mysql信息的删除，使用seequelize,写全信息")])]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220218091845.png",alt:"image-20220218091844409"}})]),t._v(" "),a("p",[a("strong",[t._v("同样项目上线也要修改")])]),t._v(" "),a("blockquote",[a("p",[t._v("封装seq")])]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220218092120.png",alt:"image-20220218092119273"}})]),t._v(" "),a("blockquote",[a("p",[t._v("在seq.js同级别的model创建user表模型")])]),t._v(" "),a("p",[t._v("比如创建User表")]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220218092616.png",alt:"image-20220218092615210"}})]),t._v(" "),a("h5",{attrs:{id:"sequelize-automate-gm自动生成model"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#sequelize-automate-gm自动生成model"}},[t._v("#")]),t._v(" sequelize-automate-gm自动生成model")]),t._v(" "),a("p",[t._v("自动生成和更新著名 ORM 框架 "),a("a",{attrs:{href:"https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fsequelize%2Fsequelize",target:"_blank",rel:"noopener noreferrer"}},[t._v("sequelizejs"),a("OutboundLink")],1),t._v(" 的 Model 代码。本项目脱胎于 "),a("a",{attrs:{href:"https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnodejh%2Fsequelize-automate",target:"_blank",rel:"noopener noreferrer"}},[t._v("sequelize-automate"),a("OutboundLink")],1),t._v("，新增及优化内容如下：")]),t._v(" "),a("ul",[a("li",[t._v("新增了 shell 交互，使用变得更简单。")]),t._v(" "),a("li",[t._v("自动增量更新，使库表修改直接映射到 Model 对应的代码上，而你自己在 Model 内的修改不会受到影响。")]),t._v(" "),a("li",[t._v("ts Model 的生成直接将结构定义写在 Model 类内部，不再生成 *.d.ts 定义文件。")]),t._v(" "),a("li",[t._v("修复了部分 ts 的 eslint 错误。")]),t._v(" "),a("li",[t._v("支持 es6、commonjs 两种模块化代码。")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("重要提示：自动生成的 Model 仍需要经过 review 检查，避免由于工具的未知问题，对你的代码产生负面影响。\n")])])]),a("h5",{attrs:{id:"安装"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装"}},[t._v("#")]),t._v(" 安装")]),t._v(" "),a("h6",{attrs:{id:"全局安装"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#全局安装"}},[t._v("#")]),t._v(" 全局安装")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("npm install -g sequelize-automate-gm\n复制代码\n")])])]),a("h6",{attrs:{id:"项目内安装"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#项目内安装"}},[t._v("#")]),t._v(" 项目内安装")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("npm install sequelize-automate-gm\n复制代码\n")])])]),a("h6",{attrs:{id:"使用方式"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#使用方式"}},[t._v("#")]),t._v(" 使用方式")]),t._v(" "),a("p",[t._v("第一步：配置文件")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('module.exports = {\n  "dbOptions": {             // sequelize 数据库配置，该配置用于读取库配置信息\n    "database": "db_test",  // 数据库名称\n    "username": "guess",    // 用户\n    "password": "guess",    // 密码\n    "dialect": "mysql",     // 数据库方言\n    "host": "localhost",    // 数据库服务地址\n    "port": 3306,           // 数据库服务端口号\n    "define": {\n      "underscored": true,\n      "freezeTableName": true,\n    }\n  },\n  "options": {                  // 生成文件的配置信息\n    "type": "js",               // 生成代码类型，支持 ts、js\n    "dir": "./test/demo/model", // 生成代码文件的输出位置\n    "moduleType": "commonjs",   // 生成代码的模块化方式，支持 commonjs、es6\n    "sequelizeName": \'Sequelize\', // Sequelize 引入Sequelize模块的变量名，默认 Sequelize\n    "sequelizeModulePath": \'sequelize\', // Sequelize 引入Sequelize模块的模，默认 sequelize\n    "sequelizeInsName": \'sequelizeClient\', // Sequelize实例的变量名，默认 sequelizeClient\n    "sequelizeInsModulePath": \'../lib/sequelize.js\', // Sequelize实例的模块路径，无默认值，必填。\n  }\n}\n复制代码\n')])])]),a("p",[t._v("上述配置文件中 "),a("code",[t._v("sequelizeName")]),t._v("、"),a("code",[t._v("sequelizeModulePath")]),t._v("、"),a("code",[t._v("sequelizeInsName")]),t._v("、"),a("code",[t._v("sequelizeInsModulePath")]),t._v(" 四个配置是为了满足有些项目对 sequelize 做了自己的封装，生成 Model 时需要按照自己的需求命名变量和指定模块路径。其中"),a("code",[t._v("sequelizeInsModulePath")]),t._v("为必填，是因为我已经假设你的项目一定会对 Sequelize 的实例化做了封装。")]),t._v(" "),a("p",[t._v("第二步：执行命令")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("sagm -c /path/to/config\n复制代码\n")])])]),a("blockquote",[a("p",[t._v("sagm = Sequelize Automate Generate Model")])]),t._v(" "),a("p",[t._v("运行效果")]),t._v(" "),a("p",[t._v("交互页面")]),t._v(" "),a("blockquote",[a("h4",{attrs:{id:"选择生成部分表的model还是全部表的model"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#选择生成部分表的model还是全部表的model"}},[t._v("#")]),t._v(" 选择生成部分表的Model还是全部表的Model")])]),t._v(" "),a("p",[a("a",{attrs:{href:"https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FIveHD%2Fsequelize-automate-gm%2Fblob%2FHEAD%2Ftest%2Fimgs%2F1.png",target:"_blank",rel:"noopener noreferrer"}},[a("img",{attrs:{src:"%E5%B0%8F%E6%B5%AA%E5%A4%8D%E4%B9%A0Node.js+express+koa2+egg%E5%AD%A6%E4%B9%A0.assets/78c3d7eb53094537bd0a72c54e229e36tplv-k3u1fbpfcp-watermark.awebp",alt:"这是图片"}}),a("OutboundLink")],1)]),t._v(" "),a("blockquote",[a("h4",{attrs:{id:"选择要生成的表-空格check"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#选择要生成的表-空格check"}},[t._v("#")]),t._v(" 选择要生成的表，空格check")])]),t._v(" "),a("p",[a("a",{attrs:{href:"https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FIveHD%2Fsequelize-automate-gm%2Fblob%2FHEAD%2Ftest%2Fimgs%2F2.png",target:"_blank",rel:"noopener noreferrer"}},[a("img",{attrs:{src:"%E5%B0%8F%E6%B5%AA%E5%A4%8D%E4%B9%A0Node.js+express+koa2+egg%E5%AD%A6%E4%B9%A0.assets/1ee397f5b13948728522155d477091f3tplv-k3u1fbpfcp-watermark.awebp",alt:"这是图片"}}),a("OutboundLink")],1)]),t._v(" "),a("blockquote",[a("h4",{attrs:{id:"选择增量更新-读取已有文件-做增量更新-还是完全替换-用新生成的代码完全替换已有的"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#选择增量更新-读取已有文件-做增量更新-还是完全替换-用新生成的代码完全替换已有的"}},[t._v("#")]),t._v(" 选择增量更新（读取已有文件，做增量更新）还是完全替换（用新生成的代码完全替换已有的）")])]),t._v(" "),a("p",[a("a",{attrs:{href:"https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FIveHD%2Fsequelize-automate-gm%2Fblob%2FHEAD%2Ftest%2Fimgs%2F3.png",target:"_blank",rel:"noopener noreferrer"}},[a("img",{attrs:{src:"%E5%B0%8F%E6%B5%AA%E5%A4%8D%E4%B9%A0Node.js+express+koa2+egg%E5%AD%A6%E4%B9%A0.assets/92455af2516943c5bd6f3fa35bbb20fftplv-k3u1fbpfcp-watermark.awebp",alt:"这是图片"}}),a("OutboundLink")],1)]),t._v(" "),a("blockquote",[a("h3",{attrs:{id:"生成代码"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#生成代码"}},[t._v("#")]),t._v(" 生成代码")])]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// javascript")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" Sequelize "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Sequelize'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" sequelizeClient "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'../lib/sequelize.js'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  DataTypes"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  Model\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Sequelize"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Student")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("extends")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Model")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" attributes "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("id")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("type")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" DataTypes"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("INTEGER")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("allowNull")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("defaultValue")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("primaryKey")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("autoIncrement")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("comment")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("''")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("field")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'id'")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("type")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" DataTypes"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("STRING")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("45")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("allowNull")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("defaultValue")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("primaryKey")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("autoIncrement")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("comment")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("''")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("field")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'name'")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("age")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("type")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" DataTypes"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("INTEGER")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("allowNull")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("defaultValue")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("primaryKey")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("autoIncrement")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("comment")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("''")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("field")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'age'")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("type")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" DataTypes"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("STRING")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("45")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("allowNull")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("defaultValue")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("primaryKey")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("autoIncrement")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("comment")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("''")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("field")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'class'")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" options "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("modelName")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'student'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("sequelize")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" sequelizeClient"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("indexes")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nStudent"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("init")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("attributes"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" options"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nmodule"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Student"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// typescript")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" Sequelize "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Sequelize'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" sequelizeClient "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'../lib/sequelize.js'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  DataTypes"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  Model\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Sequelize"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Student")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("extends")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Model")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  id"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" number"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  name"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" string"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  age"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" number"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" string"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" attributes "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("id")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("type")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" DataTypes"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("INTEGER")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("allowNull")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("defaultValue")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("primaryKey")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("autoIncrement")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("comment")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("''")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("field")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'id'")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("type")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" DataTypes"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("STRING")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("45")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("allowNull")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("defaultValue")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("primaryKey")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("autoIncrement")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("comment")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("''")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("field")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'name'")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("age")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("type")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" DataTypes"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("INTEGER")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("allowNull")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("defaultValue")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("primaryKey")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("autoIncrement")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("comment")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("''")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("field")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'age'")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("type")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" DataTypes"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("STRING")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("45")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("allowNull")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("defaultValue")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("primaryKey")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("autoIncrement")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("comment")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("''")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("field")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'class'")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" options "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("modelName")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'student'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("sequelize")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" sequelizeClient"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("indexes")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nStudent"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("init")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("attributes"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" options"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nmodule"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Student"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("blockquote",[a("p",[t._v("在seq同级目录下创建sync.js用来测试表模型和创建表")])]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220218092833.png",alt:"image-20220218092832103"}})]),t._v(" "),a("p",[t._v("把之前使用的原生的mysql代码给注释掉")]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220218092951.png",alt:"image-20220218092950295"}})]),t._v(" "),a("p",[t._v("用sequelize替换")]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220218093737.png",alt:"image-20220218093736194"}})]),t._v(" "),a("h3",{attrs:{id:"nodemon"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#nodemon"}},[t._v("#")]),t._v(" nodemon")]),t._v(" "),a("p",[t._v("是一个监视服务端应用程序文件改变的包，一且nodemon发现我们修改了服务器文件，它就会自动重启服务这样我们就可以省去ctrl+c 停止服务->启动服务，这个步骤")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 本地安装")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("npm")]),t._v(" i nodemon\nnodemon app. js\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 全局安全")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("npm")]),t._v(" i nodemon -g\nnodemon app. js\n")])])]),a("h3",{attrs:{id:"环境变量"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#环境变量"}},[t._v("#")]),t._v(" 环境变量")]),t._v(" "),a("h4",{attrs:{id:"_1-不同平台设置环境变量方式"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-不同平台设置环境变量方式"}},[t._v("#")]),t._v(" 1.不同平台设置环境变量方式")]),t._v(" "),a("blockquote",[a("p",[t._v("例如: windows 下配置NODE_ ENV")])]),t._v(" "),a("p",[t._v("首先查看NODE ENV是否存在")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("set")]),t._v(" NODE ENV\n")])])]),a("p",[t._v("如果不存在则添加环境变量")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("set")]),t._v(" NODE "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("ENV")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("production\n")])])]),a("p",[t._v("某些时候需要删除环境变量")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("set")]),t._v(" NODE "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("ENV")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("\n")])])]),a("blockquote",[a("p",[t._v("例如: Linux 下配置NODE ENV")])]),t._v(" "),a("p",[t._v("首先查看NODE_ ENV是否存在")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("echo")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$NODE_")]),t._v(" ENV\n")])])]),a("p",[t._v("如果不存在则添加环境变量")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("export")]),t._v(" NODE_ "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("ENV")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("production\n")])])]),a("p",[t._v("某些时候需要删除环境变量")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("unset")]),t._v(" NODE ENV\n")])])]),a("h4",{attrs:{id:"_2-什么是cross-env"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-什么是cross-env"}},[t._v("#")]),t._v(" 2.什么是"),a("code",[t._v("cross-env")]),t._v("?")]),t._v(" "),a("p",[a("code",[t._v("cross-env")]),t._v("是款运行跨平台的设置和使用环境变量的脚本。")]),t._v(" "),a("h4",{attrs:{id:"_3-为什么要使用cross-env"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-为什么要使用cross-env"}},[t._v("#")]),t._v(" 3.为什么要使用cross-env")]),t._v(" "),a("p",[t._v("因为我们在自定义配置环境变量的时候，\n由于在不同的环境下，配置的方式也是不同\n所以我们需要使用cross-env来统一配置 方式")]),t._v(" "),a("h4",{attrs:{id:"_4-cross-env使用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-cross-env使用"}},[t._v("#")]),t._v(" 4.cross-env使用")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("npm")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" --save-dev cross-env\n")])])]),a("div",{staticClass:"language-json extra-class"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[t._v("  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"scripts"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"dev"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"cross-env NODE_ENV=dev nodemon app.js"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"build"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"cross-env NODE_ENV=pro nodemon app.js"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n")])])]),a("h2",{attrs:{id:"express"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#express"}},[t._v("#")]),t._v(" Express")]),t._v(" "),a("h3",{attrs:{id:"安装-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装-2"}},[t._v("#")]),t._v(" 安装")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("npm")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" express -g\n")])])]),a("h3",{attrs:{id:"基础骨架"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#基础骨架"}},[t._v("#")]),t._v(" 基础骨架")]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220218103752.png",alt:"image-20220218103751528"}})]),t._v(" "),a("h3",{attrs:{id:"处理静态资源"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#处理静态资源"}},[t._v("#")]),t._v(" 处理静态资源")]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220218103944.png",alt:"image-20220218103943738"}})]),t._v(" "),a("h3",{attrs:{id:"处理动态网页"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#处理动态网页"}},[t._v("#")]),t._v(" 处理动态网页")]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220218104133.png",alt:"image-20220218104131818"}})]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220218104118.png",alt:"image-20220218104116128"}})]),t._v(" "),a("h4",{attrs:{id:"安装ejs"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装ejs"}},[t._v("#")]),t._v(" 安装ejs")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("npm")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" ejs\n")])])]),a("p",[t._v("把"),a("code",[t._v("index.html")]),t._v("改为"),a("code",[t._v("index.ejs")])]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220218104305.png",alt:"image-20220218104303994"}})]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220218104925.png",alt:"image-20220218104923931"}})]),t._v(" "),a("h3",{attrs:{id:"处理路由1"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#处理路由1"}},[t._v("#")]),t._v(" 处理路由1")]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220218105917.png",alt:"image-20220218105915642"}})]),t._v(" "),a("h3",{attrs:{id:"处理路由2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#处理路由2"}},[t._v("#")]),t._v(" 处理路由2")]),t._v(" "),a("blockquote",[a("p",[t._v("分文件处理不同的东西")])]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220218110500.png",alt:"image-20220218110459026"}})]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("module.exports "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" router\n")])])]),a("p",[t._v("然后在app.js导入")]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220218110538.png",alt:"image-20220218110537030"}})]),t._v(" "),a("h3",{attrs:{id:"处理请求参数"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#处理请求参数"}},[t._v("#")]),t._v(" 处理请求参数")]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220218111324.png",alt:"image-20220218111323433"}})]),t._v(" "),a("blockquote",[a("p",[t._v("解析cookie")])]),t._v(" "),a("p",[t._v("安装")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("npm")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" cookie-parser\n")])])]),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220218111704.png",alt:"image-20220218111703087"}})]),t._v(" "),a("h3",{attrs:{id:"express-next方法"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#express-next方法"}},[t._v("#")]),t._v(" express next方法")]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220218112202.png",alt:"image-20220218112201510"}})]),t._v(" "),a("img",{staticStyle:{zoom:"67%"},attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220218112541.png",alt:"image-20220218112522669"}}),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220218120941.png",alt:"image-20220218120940246"}})]),t._v(" "),a("h3",{attrs:{id:"express错误处理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#express错误处理"}},[t._v("#")]),t._v(" express错误处理")]),t._v(" "),a("blockquote",[a("p",[t._v("安装http-errors")])]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("npm")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" http-errors\n")])])]),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220218121310.png",alt:"image-20220218121309016"}})]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220218121729.png",alt:"image-20220218121726217"}})]),t._v(" "),a("h3",{attrs:{id:"express中间件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#express中间件"}},[t._v("#")]),t._v(" express中间件")]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220218122018.png",alt:"image-20220218122017347"}})]),t._v(" "),a("h3",{attrs:{id:"express脚手架"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#express脚手架"}},[t._v("#")]),t._v(" express脚手架")]),t._v(" "),a("blockquote",[a("p",[t._v("安装")])]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("npm")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" -g express-generator\n")])])]),a("blockquote",[a("p",[t._v("创建express项目")])]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("express 项目名\n")])])]),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220218122801.png",alt:"image-20220218122800588"}})]),t._v(" "),a("p",[t._v("安装以上几个")]),t._v(" "),a("h3",{attrs:{id:"储存登录状态"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#储存登录状态"}},[t._v("#")]),t._v(" 储存登录状态")]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220218130036.png",alt:"image-20220218130034704"}})]),t._v(" "),a("blockquote",[a("p",[t._v("安装express-session")])]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("npm")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" express-session\n")])])]),a("blockquote",[a("p",[t._v("导入")])]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" session "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'express-session'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("blockquote",[a("p",[t._v("配置")])]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("app"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("use")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("session")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("secret")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'keyboard cat'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("resave")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("saveUninitialized")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("cookie")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("secure")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220218173213.png",alt:"image-20220218173212520"}})]),t._v(" "),a("p",[t._v("这么登录完成之后保存登录状态")]),t._v(" "),a("p",[a("img",{attrs:{src:"%E5%B0%8F%E6%B5%AA%E5%A4%8D%E4%B9%A0Node.js+express+koa2+egg%E5%AD%A6%E4%B9%A0.assets/image-20220218173718715.png",alt:"image-20220218173718715"}})]),t._v(" "),a("p",[t._v("可以测试是否登录")]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220218173829.png",alt:"image-20220218173828210"}})]),t._v(" "),a("p",[t._v("安装"),a("code",[t._v("connect-redis")])]),t._v(" "),a("div",{staticClass:"language-ba extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("npm install redis connect-redis express-session\n")])])]),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220218174246.png",alt:"image-20220218174245398"}})]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220218174332.png",alt:"image-20220218174329856"}})]),t._v(" "),a("blockquote",[a("p",[t._v("redisClient哪来呢，是之前的封装的redis.js改下导出的")])]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220218174420.png",alt:"image-20220218174418855"}})]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220218174442.png",alt:"image-20220218174441295"}})]),t._v(" "),a("p",[t._v("然后就可以使用了，用"),a("code",[t._v("redis-cli -h 127.0.0.1 -p redis保存的端口号")]),t._v(" 查看保存的key")]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220218174542.png",alt:"image-20220218174540950"}})]),t._v(" "),a("h3",{attrs:{id:"记录日志"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#记录日志"}},[t._v("#")]),t._v(" 记录日志")]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220218174827.png",alt:"image-20220218174825774"}})]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220218174929.png",alt:"image-20220218174928108"}})]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220218175124.png",alt:"image-20220218175123245"}})]),t._v(" "),a("p",[t._v("记录详细一点")]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220218175050.png",alt:"image-20220218175048206"}})]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220218175104.png",alt:"image-20220218175103448"}})]),t._v(" "),a("blockquote",[a("p",[t._v("写入到文件中")])]),t._v(" "),a("p",[t._v("导入模块")]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220218175241.png",alt:"image-20220218175239395"}})]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" accessLogStream "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" fs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("createWriteStream")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("path"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("join")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("__dirname"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'log/access.log'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("flags")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'a'")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\napp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("use")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("morgan")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'combined'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("stream")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" accessLogStream "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("h2",{attrs:{id:"koa2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#koa2"}},[t._v("#")]),t._v(" KOA2")]),t._v(" "),a("h3",{attrs:{id:"简介"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#简介"}},[t._v("#")]),t._v(" 简介")]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220218175836.png",alt:"image-20220218175835157"}})]),t._v(" "),a("h3",{attrs:{id:"基本使用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#基本使用"}},[t._v("#")]),t._v(" 基本使用")]),t._v(" "),a("p",[t._v("1.手动安装和配配置")]),t._v(" "),a("blockquote",[a("p",[t._v("安装(默认安装的是 KOA2,KOA1被淘汰了)")])]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("npm")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" koa\n")])])]),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" Koa "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'koa'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" app "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Koa")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// response")]),t._v("\napp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("use")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("ctx")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  ctx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("body "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Hello Koa'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\napp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("listen")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3000")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220218180252.png",alt:"image-20220218180250753"}})]),t._v(" "),a("h3",{attrs:{id:"处理静态资源-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#处理静态资源-2"}},[t._v("#")]),t._v(" 处理静态资源")]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220218180623.png",alt:"image-20220218180622416"}})]),t._v(" "),a("blockquote",[a("p",[t._v("安装")])]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("npm")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" koa-static\n")])])]),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220218180830.png",alt:"image-20220218180829468"}})]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" serve "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'koa-static'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" Koa "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'koa'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" app "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Koa")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// $ GET /package.json")]),t._v("\napp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("use")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("serve")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'.'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// $ GET /hello.txt")]),t._v("\napp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("use")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("serve")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'test/fixtures'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// or use absolute paths")]),t._v("\napp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("use")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("serve")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("__dirname "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/test/fixtures'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n \napp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("listen")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3000")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n \nconsole"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'listening on port 3000'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("h3",{attrs:{id:"处理动态资源"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#处理动态资源"}},[t._v("#")]),t._v(" 处理动态资源")]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220218180915.png",alt:"image-20220218180914675"}})]),t._v(" "),a("blockquote",[a("p",[t._v("安装")])]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("npm")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" koa-views\n")])])]),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// npm 例子")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" views "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'koa-views'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" render "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("views")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("__dirname "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/views'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("map")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("html")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'underscore'")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Must be used before any router is used")]),t._v("\napp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("use")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("render"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// OR Expand by app.context")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// No order restrictions")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// app.context.render = render()")]),t._v("\n\napp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("use")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("async")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("ctx")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  ctx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("state "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("session")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("session"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("title")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'app'")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" ctx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("render")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'user'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("user")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'John'")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("blockquote",[a("p",[t._v("ejs文件")])]),t._v(" "),a("img",{staticStyle:{zoom:"80%"},attrs:{src:"小浪复习Node.js+express+koa2+egg学习.assets/image-20220218181157070.png",alt:"image-20220218181157070"}}),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220218181441.png",alt:"image-20220218181440216"}})]),t._v(" "),a("h3",{attrs:{id:"处理路由-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#处理路由-2"}},[t._v("#")]),t._v(" 处理路由")]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220218181605.png",alt:"image-20220218181604308"}})]),t._v(" "),a("blockquote",[a("p",[t._v("安装")])]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("npm")]),t._v(" i @koa/router\n")])])]),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220218185550.png",alt:"image-20220218185549493"}})]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220218185903.png",alt:"image-20220218185902859"}})]),t._v(" "),a("h3",{attrs:{id:"处理get请求参数"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#处理get请求参数"}},[t._v("#")]),t._v(" 处理GET请求参数")]),t._v(" "),a("blockquote",[a("p",[t._v("传统")])]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220218200428.png",alt:"image-20220218200427155"}})]),t._v(" "),a("blockquote",[a("p",[t._v("获取动态路由形式")])]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220218200717.png",alt:"image-20220218200716123"}})]),t._v(" "),a("h3",{attrs:{id:"处理post请求参数"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#处理post请求参数"}},[t._v("#")]),t._v(" 处理POST请求参数")]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220218200834.png",alt:"image-20220218200832380"}})]),t._v(" "),a("blockquote",[a("p",[t._v("安装")])]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("npm")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" koa-bodyparser\n")])])]),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220218201056.png",alt:"image-20220218201050341"}})]),t._v(" "),a("h3",{attrs:{id:"处理cookie"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#处理cookie"}},[t._v("#")]),t._v(" 处理Cookie")]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220218201155.png",alt:"image-20220218201154361"}})]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220218201256.png",alt:"image-20220218201254986"}})]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220218201404.png",alt:"image-20220218201403494"}})]),t._v(" "),a("p",[t._v("path是Cookie有效范围")]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220218201535.png",alt:"image-20220218201534601"}})]),t._v(" "),a("blockquote",[a("p",[t._v("非要设置的")])]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220218201748.png",alt:"image-20220218201747177"}})]),t._v(" "),a("blockquote",[a("p",[t._v("所以可以这么写")])]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220218201946.png",alt:"image-20220218201945548"}})]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220218202019.png",alt:"image-20220218202018452"}})]),t._v(" "),a("h3",{attrs:{id:"处理错误"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#处理错误"}},[t._v("#")]),t._v(" 处理错误")]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220218202103.png",alt:"image-20220218202102596"}})]),t._v(" "),a("blockquote",[a("p",[t._v("安装")])]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("npm")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" koa-onerror\n")])])]),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220218203542.png",alt:"image-20220218203540588"}})]),t._v(" "),a("h3",{attrs:{id:"脚手架的使用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#脚手架的使用"}},[t._v("#")]),t._v(" 脚手架的使用")]),t._v(" "),a("blockquote",[a("p",[t._v("安装")])]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("npm")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" -g koa-generator\n")])])]),a("blockquote",[a("p",[t._v("创建项目")])]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("koa1 项目名\nkoa2 项目名\n")])])]),a("blockquote",[a("p",[t._v("app.js")])]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220218204314.png",alt:""}})]),t._v(" "),a("h3",{attrs:{id:"实现登录注册"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#实现登录注册"}},[t._v("#")]),t._v(" 实现登录注册")]),t._v(" "),a("p",[t._v("把之前需要的依赖都安装一下，cross-env ejs mysql2 redis")]),t._v(" "),a("blockquote",[a("p",[t._v("改造user路由")])]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220218205005.png",alt:"image-20220218205004220"}})]),t._v(" "),a("p",[t._v("在app.js导入路由并启用")]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220218205200.png",alt:"image-20220218205159727"}})]),t._v(" "),a("h3",{attrs:{id:"保存登录状态"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#保存登录状态"}},[t._v("#")]),t._v(" 保存登录状态")]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220218205308.png",alt:"image-20220218205307314"}})]),t._v(" "),a("blockquote",[a("p",[t._v("安装")])]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("npm")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" koa-generic-session koa-redis\n")])])]),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220218205736.png",alt:"image-20220218205735489"}})]),t._v(" "),a("blockquote",[a("p",[t._v("在登录的时候存储登录状态")])]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220218205951.png",alt:"image-20220218205950622"}})]),t._v(" "),a("h3",{attrs:{id:"处理日志"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#处理日志"}},[t._v("#")]),t._v(" 处理日志")]),t._v(" "),a("blockquote",[a("p",[t._v("安装koa-morgan可以把日志写入文件")])]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220218211020.png",alt:"image-20220218211019686"}})]),t._v(" "),a("h3",{attrs:{id:"cookie跨域问题"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#cookie跨域问题"}},[t._v("#")]),t._v(" Cookie跨域问题")]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220218211233.png",alt:"image-20220218211231858"}})]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220218211509.png",alt:"image-20220218211508386"}})]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220218211922.png",alt:"image-20220218211920151"}})]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220218212103.png",alt:"image-20220218212102331"}})]),t._v(" "),a("blockquote",[a("p",[t._v("修改Nginx文件")])]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220218212448.png",alt:"image-20220218212447506"}})]),t._v(" "),a("h2",{attrs:{id:"node上线"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#node上线"}},[t._v("#")]),t._v(" Node上线")]),t._v(" "),a("h3",{attrs:{id:"pm2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#pm2"}},[t._v("#")]),t._v(" PM2"),a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220218212654.png",alt:"image-20220218212653144"}})]),t._v(" "),a("h3",{attrs:{id:"常用命令"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#常用命令"}},[t._v("#")]),t._v(" "),a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220218212755.png",alt:"image-20220218212754263"}}),t._v("常用命令")]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220218212847.png",alt:"image-20220218212846821"}})]),t._v(" "),a("h3",{attrs:{id:"常用配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#常用配置"}},[t._v("#")]),t._v(" 常用配置")]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220218213324.png",alt:"image-20220218213322934"}})]),t._v(" "),a("blockquote",[a("p",[t._v("例如")])]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220218213402.png",alt:"image-20220218213401612"}})]),t._v(" "),a("blockquote",[a("p",[t._v("通过配置文件启动")])]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220218213440.png",alt:"image-20220218213438944"}})]),t._v(" "),a("h3",{attrs:{id:"负载均衡"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#负载均衡"}},[t._v("#")]),t._v(" 负载均衡")]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220218213655.png",alt:"image-20220218213654291"}})]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220218213914.png",alt:"image-20220218213913146"}})]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220218213713.png",alt:"image-20220218213711848"}})]),t._v(" "),a("blockquote",[a("p",[t._v("日志也有四个")])]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220218213728.png",alt:"image-20220218213727666"}})]),t._v(" "),a("h2",{attrs:{id:"egg-js"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#egg-js"}},[t._v("#")]),t._v(" Egg.js")]),t._v(" "),a("h3",{attrs:{id:"简介-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#简介-2"}},[t._v("#")]),t._v(" 简介")]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220218214002.png",alt:"image-20220218214001133"}})]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220218214139.png",alt:"image-20220218214137875"}})]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220218214201.png",alt:"image-20220218214159510"}})]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220218214238.png",alt:"image-20220218214232425"}})]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220218214506.png",alt:"image-20220218214505929"}})]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220218214438.png",alt:"image-20220218214437516"}})]),t._v(" "),a("h3",{attrs:{id:"手动安装"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#手动安装"}},[t._v("#")]),t._v(" 手动安装")]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220218214636.png",alt:"image-20220218214634571"}})]),t._v(" "),a("p",[t._v("为了提升研发体验，我们提供了便捷的方式在本地进行开发、调试、单元测试等。")]),t._v(" "),a("p",[t._v("在这里我们需要使用到 "),a("a",{attrs:{href:"https://github.com/eggjs/egg-bin",target:"_blank",rel:"noopener noreferrer"}},[t._v("egg-bin"),a("OutboundLink")],1),t._v(" 模块（只在本地开发和单元测试使用，如果线上请参考 "),a("a",{attrs:{href:"https://www.eggjs.org/zh-CN/core/deployment",target:"_blank",rel:"noopener noreferrer"}},[t._v("应用部署"),a("OutboundLink")],1),t._v("）。")]),t._v(" "),a("p",[t._v("首先，我们需要把 "),a("code",[t._v("egg-bin")]),t._v(" 模块作为 "),a("code",[t._v("devDependencies")]),t._v(" 引入：")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("npm")]),t._v(" i egg-bin --save-dev\n")])])]),a("h3",{attrs:{id:"添加命令"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#添加命令"}},[t._v("#")]),t._v(" 添加命令")]),t._v(" "),a("p",[t._v("添加 "),a("code",[t._v("npm scripts")]),t._v(" 到 "),a("code",[t._v("package.json")]),t._v("：")]),t._v(" "),a("div",{staticClass:"language-json extra-class"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"scripts"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"dev"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"egg-bin dev"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("这样我们就可以通过 "),a("code",[t._v("npm run dev")]),t._v(" 命令启动应用。")]),t._v(" "),a("h3",{attrs:{id:"目录结构"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#目录结构"}},[t._v("#")]),t._v(" 目录结构")]),t._v(" "),a("blockquote",[a("p",[t._v("必须满足目录结构，不然不能运行")])]),t._v(" "),a("p",[t._v("在"),a("a",{attrs:{href:"https://www.eggjs.org/zh-CN/intro/quickstart",target:"_blank",rel:"noopener noreferrer"}},[t._v("快速入门"),a("OutboundLink")],1),t._v("中，大家对框架应该有了初步的印象，接下来我们简单了解下目录约定规范。")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("egg-project\n├── package.json\n├── app.js "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("可选"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n├── agent.js "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("可选"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n├── app\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("   ├── router.js\n│   ├── controller\n│   "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("   └── home.js\n│   ├── "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("service")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("可选"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n│   "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("   └── user.js\n│   ├── middleware "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("可选"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n│   "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("   └── response_time.js\n│   ├── schedule "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("可选"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n│   "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("   └── my_task.js\n│   ├── public "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("可选"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n│   "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("   └── reset.css\n│   ├── view "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("可选"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n│   "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("   └── home.tpl\n│   └── extend "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("可选"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n│       ├── helper.js "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("可选"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n│       ├── request.js "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("可选"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n│       ├── response.js "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("可选"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n│       ├── context.js "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("可选"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n│       ├── application.js "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("可选"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n│       └── agent.js "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("可选"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n├── config\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("   ├── plugin.js\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("   ├── config.default.js\n│   ├── config.prod.js\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("   ├── config.test.js "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("可选"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("   ├── config.local.js "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("可选"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("   └── config.unittest.js "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("可选"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n└── "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("test")]),t._v("\n    ├── middleware\n    "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("   └── response_time.test.js\n    └── controller\n        └── home.test.js\n")])])]),a("p",[t._v("如上，由框架约定的目录：")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("app/router.js")]),t._v(" 用于配置 URL 路由规则，具体参见 "),a("a",{attrs:{href:"https://www.eggjs.org/zh-CN/basics/router",target:"_blank",rel:"noopener noreferrer"}},[t._v("Router"),a("OutboundLink")],1),t._v("。")]),t._v(" "),a("li",[a("code",[t._v("app/controller/**")]),t._v(" 用于解析用户的输入，处理后返回相应的结果，具体参见 "),a("a",{attrs:{href:"https://www.eggjs.org/zh-CN/basics/controller",target:"_blank",rel:"noopener noreferrer"}},[t._v("Controller"),a("OutboundLink")],1),t._v("。")]),t._v(" "),a("li",[a("code",[t._v("app/service/**")]),t._v(" 用于编写业务逻辑层，可选，建议使用，具体参见 "),a("a",{attrs:{href:"https://www.eggjs.org/zh-CN/basics/service",target:"_blank",rel:"noopener noreferrer"}},[t._v("Service"),a("OutboundLink")],1),t._v("。")]),t._v(" "),a("li",[a("code",[t._v("app/middleware/**")]),t._v(" 用于编写中间件，可选，具体参见 "),a("a",{attrs:{href:"https://www.eggjs.org/zh-CN/basics/middleware",target:"_blank",rel:"noopener noreferrer"}},[t._v("Middleware"),a("OutboundLink")],1),t._v("。")]),t._v(" "),a("li",[a("code",[t._v("app/public/**")]),t._v(" 用于放置静态资源，可选，具体参见内置插件 "),a("a",{attrs:{href:"https://github.com/eggjs/egg-static",target:"_blank",rel:"noopener noreferrer"}},[t._v("egg-static"),a("OutboundLink")],1),t._v("。")]),t._v(" "),a("li",[a("code",[t._v("app/extend/**")]),t._v(" 用于框架的扩展，可选，具体参见"),a("a",{attrs:{href:"https://www.eggjs.org/zh-CN/basics/extend",target:"_blank",rel:"noopener noreferrer"}},[t._v("框架扩展"),a("OutboundLink")],1),t._v("。")]),t._v(" "),a("li",[a("code",[t._v("config/config.{env}.js")]),t._v(" 用于编写配置文件，具体参见"),a("a",{attrs:{href:"https://www.eggjs.org/zh-CN/basics/config",target:"_blank",rel:"noopener noreferrer"}},[t._v("配置"),a("OutboundLink")],1),t._v("。")]),t._v(" "),a("li",[a("code",[t._v("config/plugin.js")]),t._v(" 用于配置需要加载的插件，具体参见"),a("a",{attrs:{href:"https://www.eggjs.org/zh-CN/basics/plugin",target:"_blank",rel:"noopener noreferrer"}},[t._v("插件"),a("OutboundLink")],1),t._v("。")]),t._v(" "),a("li",[a("code",[t._v("test/**")]),t._v(" 用于单元测试，具体参见"),a("a",{attrs:{href:"https://www.eggjs.org/zh-CN/core/unittest",target:"_blank",rel:"noopener noreferrer"}},[t._v("单元测试"),a("OutboundLink")],1),t._v("。")]),t._v(" "),a("li",[a("code",[t._v("app.js")]),t._v(" 和 "),a("code",[t._v("agent.js")]),t._v(" 用于自定义启动时的初始化工作，可选，具体参见"),a("a",{attrs:{href:"https://www.eggjs.org/zh-CN/basics/app-start",target:"_blank",rel:"noopener noreferrer"}},[t._v("启动自定义"),a("OutboundLink")],1),t._v("。关于"),a("code",[t._v("agent.js")]),t._v("的作用参见"),a("a",{attrs:{href:"https://www.eggjs.org/zh-CN/core/cluster-and-ipc#agent-%E6%9C%BA%E5%88%B6",target:"_blank",rel:"noopener noreferrer"}},[t._v("Agent 机制"),a("OutboundLink")],1),t._v("。")])]),t._v(" "),a("p",[t._v("由内置插件约定的目录：")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("app/public/**")]),t._v(" 用于放置静态资源，可选，具体参见内置插件 "),a("a",{attrs:{href:"https://github.com/eggjs/egg-static",target:"_blank",rel:"noopener noreferrer"}},[t._v("egg-static"),a("OutboundLink")],1),t._v("。")]),t._v(" "),a("li",[a("code",[t._v("app/schedule/**")]),t._v(" 用于定时任务，可选，具体参见"),a("a",{attrs:{href:"https://www.eggjs.org/zh-CN/basics/schedule",target:"_blank",rel:"noopener noreferrer"}},[t._v("定时任务"),a("OutboundLink")],1),t._v("。")])]),t._v(" "),a("p",[a("strong",[t._v("若需自定义自己的目录规范，参见 "),a("a",{attrs:{href:"https://eggjs.org/zh-cn/advanced/loader.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("Loader API"),a("OutboundLink")],1)])]),t._v(" "),a("ul",[a("li",[a("code",[t._v("app/view/**")]),t._v(" 用于放置模板文件，可选，由模板插件约定，具体参见"),a("a",{attrs:{href:"https://www.eggjs.org/zh-CN/core/view",target:"_blank",rel:"noopener noreferrer"}},[t._v("模板渲染"),a("OutboundLink")],1),t._v("。")]),t._v(" "),a("li",[a("code",[t._v("app/model/**")]),t._v(" 用于放置领域模型，可选，由领域类相关插件约定，如 "),a("a",{attrs:{href:"https://github.com/eggjs/egg-sequelize",target:"_blank",rel:"noopener noreferrer"}},[t._v("egg-sequelize"),a("OutboundLink")],1)])]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220218215354.png",alt:"image-20220218215352719"}})]),t._v(" "),a("blockquote",[a("p",[t._v("router.js必须暴露一个方法")])]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220218215554.png",alt:"image-20220218215553692"}})]),t._v(" "),a("blockquote",[a("p",[t._v("在controller下面写个home的路由")])]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220218215918.png",alt:"image-20220218215917333"}})]),t._v(" "),a("p",[t._v("暴露出去")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("module"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" HomeController\n")])])]),a("blockquote",[a("p",[t._v("然后继续在"),a("strong",[t._v("router.js")]),t._v("编写")])]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220218220159.png",alt:"image-20220218220157341"}})]),t._v(" "),a("h3",{attrs:{id:"处理请求参数-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#处理请求参数-2"}},[t._v("#")]),t._v(" 处理请求参数")]),t._v(" "),a("blockquote",[a("p",[t._v("在"),a("code",[t._v("router.js")]),t._v("进行修改路由")])]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220219104207.png",alt:"image-20220219104159362"}})]),t._v(" "),a("blockquote",[a("p",[t._v("修改控制器里的home.js")])]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220219104524.png",alt:"image-20220219104523835"}})]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220219104546.png",alt:"image-20220219104545624"}})]),t._v(" "),a("p",[t._v("egg不能跨站发送请求，所以只能先关闭，方便我们进行post测试")]),t._v(" "),a("blockquote",[a("h4",{attrs:{id:"忽略-json-请求-已废弃"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#忽略-json-请求-已废弃"}},[t._v("#")]),t._v(" 忽略 JSON 请求(已废弃)")]),t._v(" "),a("p",[a("strong",[t._v("注意：该选项已废弃，攻击者可以"),a("a",{attrs:{href:"https://www.geekboy.ninja/blog/exploiting-json-cross-site-request-forgery-csrf-using-flash/",target:"_blank",rel:"noopener noreferrer"}},[t._v("通过 flash + 307 来攻破"),a("OutboundLink")],1),t._v("，请不要在生产环境打开改选项！")])]),t._v(" "),a("p",[t._v("在 "),a("a",{attrs:{href:"https://en.wikipedia.org/wiki/Same-origin_policy",target:"_blank",rel:"noopener noreferrer"}},[t._v("SOP"),a("OutboundLink")],1),t._v(" 的安全策略保护下，基本上所有的现代浏览器都不允许跨域发起 content-type 为 JSON 的请求，因此我们可以直接放过类型的 JSON 格式的请求。")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// config/config.default.js")]),t._v("\nmodule"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("security")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("csrf")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("ignoreJSON")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 默认为 false，当设置为 true 时，将会放过所有 content-type 为 `application/json` 的请求")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])])]),t._v(" "),a("p",[t._v("然后在这里修改"),a("code",[t._v("config/config.default.js")]),t._v("，就能通过postman发送请求了")]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220219105424.png",alt:"image-20220219105422409"}})]),t._v(" "),a("h3",{attrs:{id:"处理静态资源-3"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#处理静态资源-3"}},[t._v("#")]),t._v(" 处理静态资源")]),t._v(" "),a("blockquote",[a("p",[t._v("1.EggJS如何处理静态资源?不用处理，默认已经处理好了")])]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220219105742.png",alt:"image-20220219105740852"}})]),t._v(" "),a("p",[t._v("直接把静态资源放入"),a("code",[t._v("app/public")]),t._v("当中")]),t._v(" "),a("h3",{attrs:{id:"处理动态资源-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#处理动态资源-2"}},[t._v("#")]),t._v(" 处理动态资源")]),t._v(" "),a("p",[t._v("EggJS如何处理动态资源?\n1.1什么是插件?\nEggJS中的插件就是特殊的中间件\nhttps://eggjs.org/zh-cn/basics/plugin.html")]),t._v(" "),a("p",[t._v("1.2插件的使用")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("npm")]),t._v(" i egg-view-ejs -- save\n")])])]),a("p",[t._v("在"),a("code",[t._v("config")]),t._v("目录下新建"),a("code",[t._v("plugin.js")])]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("exports"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ejs"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("enable")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("package")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'egg-view-ejs'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[t._v("在"),a("code",[t._v("config.default.js")]),t._v("中新增如下配置")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("view")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("mapping")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'.html,'")]),t._v("ejs' "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("在app目录中新建view目录，将动态网页放到这个目录中\n在控制器中通过上下文render方法渲染")]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220219112120.png",alt:"image-20220219112119329"}})]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220219112400.png",alt:"image-20220219112358807"}})]),t._v(" "),a("blockquote",[a("p",[t._v("home.js添加一个路由，渲染动态的资源，index.ejs改为index.html")])]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220219112834.png",alt:"image-20220219112832873"}})]),t._v(" "),a("blockquote",[a("p",[t._v("这样就能在router启动这个路由了")])]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220219113001.png",alt:"image-20220219112959807"}})]),t._v(" "),a("h3",{attrs:{id:"处理数据"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#处理数据"}},[t._v("#")]),t._v(" 处理数据")]),t._v(" "),a("p",[t._v("EggJS处理数据\n在EggJS中无论是处理数据库中的数据还是处理网络数据，都是在Service中处理的")]),t._v(" "),a("blockquote",[a("p",[t._v("在"),a("code",[t._v("app/service")]),t._v("建立"),a("code",[t._v("home.js")]),t._v("  对应Mode层")])]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220219121446.png",alt:"image-20220219121445715"}})]),t._v(" "),a("p",[t._v("如果数据是Buffer那么转为字符串")]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220219122313.png",alt:"image-20220219122311287"}})]),t._v(" "),a("p",[t._v("测试其他方式的请求")]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220219122756.png",alt:"image-20220219122755318"}})]),t._v(" "),a("blockquote",[a("p",[t._v("在controller中的"),a("code",[t._v("HomeController")]),t._v("添加一个方法 对应控制器C层")])]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220219121932.png",alt:"image-20220219121931779"}})]),t._v(" "),a("blockquote",[a("p",[t._v("在rouer.js启动一个路由触发"),a("code",[t._v("HomeController")]),t._v("控制器的方法   对应视图V层")])]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220219121821.png",alt:"image-20220219121820485"}})]),t._v(" "),a("blockquote",[a("p",[t._v("注意点:")])]),t._v(" "),a("p",[t._v("1.service 目录必须放在app目录中")]),t._v(" "),a("p",[t._v("2.service目录支持多级目录，如果是多级目录，那么在调用的时候可以使用链式调用\n"),a("code",[t._v("this.ctx.service.abc.def.text.XX() ;")])]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220219123856.png",alt:"image-20220219123855170"}})]),t._v(" "),a("p",[t._v("3.service中的js文件，如果是以或者首字母都是大写，那么在调用的时候必须转换成驼峰命名\n"),a("code",[t._v("get_user.js --- getUser")]),t._v(" "),a("code",[t._v("GetUser.js --- getUser")])]),t._v(" "),a("h3",{attrs:{id:"处理cookie-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#处理cookie-2"}},[t._v("#")]),t._v(" 处理Cookie")]),t._v(" "),a("blockquote",[a("p",[t._v("在处理app/controller/home.js把之前的测试清理掉然后写设置Cookie和获取Cookie的方法给路由访问")])]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220219124123.png",alt:"image-20220219124121959"}})]),t._v(" "),a("blockquote",[a("p",[t._v("修改setCookie添加"),a("code",[t._v("signed:true")])])]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220219124303.png",alt:"image-20220219124257400"}})]),t._v(" "),a("blockquote",[a("p",[t._v("修改setCookie添加"),a("code",[t._v("encrypt:true")]),t._v("，进行加密（存放明文不太好），"),a("code",[t._v("getCookie")]),t._v("的时候进行解密")])]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220219124941.png",alt:"image-20220219124940482"}})]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220219124608.png",alt:"image-20220219124606757"}})]),t._v(" "),a("p",[t._v("把之前的"),a("code",[t._v("router.js")]),t._v("注册的其他的路由给清理掉重写，两个路由设置Cookie和获取Cookie")]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220219125309.png",alt:"image-20220219125308378"}})]),t._v(" "),a("p",[t._v("先访问"),a("code",[t._v("setCookie")]),t._v("，然后访问"),a("code",[t._v("getCookie")]),t._v("测试一下")]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220219124411.png",alt:"image-20220219124410415"}})]),t._v(" "),a("h3",{attrs:{id:"处理日志-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#处理日志-2"}},[t._v("#")]),t._v(" 处理日志")]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220219130137.png",alt:"image-20220219130136622"}})]),t._v(" "),a("blockquote",[a("p",[t._v("修改控制器添加test方法来输出日志")])]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220219130908.png",alt:"image-20220219130906667"}})]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220219132746.png",alt:"image-20220219132744815"}})]),t._v(" "),a("blockquote",[a("p",[t._v("添加路由，来启用控制器的方法")])]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220219131001.png",alt:"image-20220219131000360"}})]),t._v(" "),a("blockquote",[a("p",[t._v("访问Test路由，输出日志，日志将写入文件")])]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220219130611.png",alt:"image-20220219130610309"}})]),t._v(" "),a("p",[t._v("默认不输出"),a("code",[t._v("DEBUG")]),t._v("日志，修改"),a("code",[t._v("config/config.default.js")]),t._v("输出"),a("code",[t._v("DEBUG")]),t._v("日志")]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220219130419.png",alt:"image-20220219130418127"}})]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220219130556.png",alt:"image-20220219130555479"}})]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220219132719.png",alt:"image-20220219132718912"}})]),t._v(" "),a("h3",{attrs:{id:"定时任务"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#定时任务"}},[t._v("#")]),t._v(" 定时任务")]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220219134321.png",alt:"image-20220219134320577"}})]),t._v(" "),a("h4",{attrs:{id:"编写定时任务"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#编写定时任务"}},[t._v("#")]),t._v(" 编写定时任务")]),t._v(" "),a("p",[t._v("所有的定时任务都统一存放在 "),a("code",[t._v("app/schedule")]),t._v(" 目录下，每一个文件都是一个独立的定时任务，可以配置定时任务的属性和要执行的方法。")]),t._v(" "),a("p",[t._v("一个简单的例子，我们定义一个更新远程数据到内存缓存的定时任务，就可以在 "),a("code",[t._v("app/schedule")]),t._v(" 目录下创建一个 "),a("code",[t._v("update_cache.js")]),t._v(" 文件")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" Subscription "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'egg'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Subscription"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("UpdateCache")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("extends")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Subscription")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 通过 schedule 属性来设置定时任务的执行间隔等配置  static get schedule() {    return {      interval: '1m', // 1 分钟间隔      type: 'all', // 指定所有的 worker 都需要执行    };  }")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// subscribe 是真正定时任务执行时被运行的函数  async subscribe() {    const res = await this.ctx.curl('http://www.api.com/cache', {      dataType: 'json',    });    this.ctx.app.cache = res.data;  }}")]),t._v("\nmodule"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" UpdateCache"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[t._v("还可以简写为")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("module"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("schedule")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("interval")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'1m'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 1 分钟间隔")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("type")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'all'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 指定所有的 worker 都需要执行")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("async")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("task")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("ctx")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" res "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" ctx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("curl")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'http://www.api.com/cache'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("dataType")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'json'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    ctx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("app"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cache "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" res"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[t._v("这个定时任务会在每一个 Worker 进程上每 1 分钟执行一次，将远程数据请求回来挂载到 "),a("code",[t._v("app.cache")]),t._v(" 上。")]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220219134939.png",alt:"image-20220219134936372"}})]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220219134905.png",alt:"image-20220219134903028"}})]),t._v(" "),a("h3",{attrs:{id:"启动自定义"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#启动自定义"}},[t._v("#")]),t._v(" 启动自定义")]),t._v(" "),a("p",[t._v("我们常常需要在应用启动期间进行一些初始化工作，等初始化完成后应用才可以启动成功，并开始对外提供服务。")]),t._v(" "),a("p",[t._v("框架提供了统一的入口文件（"),a("code",[t._v("app.js")]),t._v("）进行启动过程自定义，这个文件返回一个 Boot 类，我们可以通过定义 Boot 类中的生命周期方法来执行启动应用过程中的初始化工作。")]),t._v(" "),a("p",[t._v("框架提供了这些 "),a("a",{attrs:{href:"https://www.eggjs.org/zh-CN/advanced/loader#life-cycles",target:"_blank",rel:"noopener noreferrer"}},[t._v("生命周期函数"),a("OutboundLink")],1),t._v("供开发人员处理：")]),t._v(" "),a("ul",[a("li",[t._v("配置文件即将加载，这是最后动态修改配置的时机（"),a("code",[t._v("configWillLoad")]),t._v("）")]),t._v(" "),a("li",[t._v("配置文件加载完成（"),a("code",[t._v("configDidLoad")]),t._v("）")]),t._v(" "),a("li",[t._v("文件加载完成（"),a("code",[t._v("didLoad")]),t._v("）")]),t._v(" "),a("li",[t._v("插件启动完毕（"),a("code",[t._v("willReady")]),t._v("）")]),t._v(" "),a("li",[t._v("worker 准备就绪（"),a("code",[t._v("didReady")]),t._v("）")]),t._v(" "),a("li",[t._v("应用启动完成（"),a("code",[t._v("serverDidReady")]),t._v("）")]),t._v(" "),a("li",[t._v("应用即将关闭（"),a("code",[t._v("beforeClose")]),t._v("）")])]),t._v(" "),a("p",[t._v("我们可以在 "),a("code",[t._v("app.js")]),t._v(" 中定义这个 Boot 类，下面我们抽取几个在应用开发中常用的生命周期函数来举例：")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// app.js")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("AppBootHook")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("constructor")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("app")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("app "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" app"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("configWillLoad")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 此时 config 文件已经被读取并合并，但是还并未生效")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 这是应用层修改配置的最后时机")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 注意：此函数只支持同步调用")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 例如：参数中的密码是加密的，在此处进行解密")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("app"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("config"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("mysql"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("password "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("decrypt")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("app"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("config"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("mysql"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("password"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 例如：插入一个中间件到框架的 coreMiddleware 之间")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" statusIdx "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("app"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("config"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("coreMiddleware"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("indexOf")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'status'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("app"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("config"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("coreMiddleware"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("splice")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("statusIdx "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'limit'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("async")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("didLoad")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 所有的配置已经加载完毕")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 可以用来加载应用自定义的文件，启动自定义的服务")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 例如：创建自定义应用的示例")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("app"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("queue "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Queue")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("app"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("config"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("queue"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("app"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("queue"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("init")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 例如：加载自定义的目录")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("app"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("loader"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("loadToContext")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("path"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("join")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("__dirname"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'app/tasks'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'tasks'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("fieldClass")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'tasksClasses'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("async")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("willReady")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 所有的插件都已启动完毕，但是应用整体还未 ready")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 可以做一些数据初始化等操作，这些操作成功才会启动应用")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 例如：从数据库加载数据到内存缓存")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("app"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cacheData "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("app"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("model"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("query")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("QUERY_CACHE_SQL")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("async")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("didReady")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 应用已经启动完毕")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" ctx "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("app"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("createAnonymousContext")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" ctx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("service"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Biz"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("request")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("async")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("serverDidReady")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// http / https server 已启动，开始接受外部请求")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 此时可以从 app.server 拿到 server 的实例")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("app"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("server"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("on")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'timeout'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("socket")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// handle socket timeout")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("blockquote",[a("p",[t._v("想在应用启动之后，把定时任务获取的数据渲染到动态资源上")])]),t._v(" "),a("blockquote",[a("p",[t._v("在app.js中 应用启动完成（"),a("code",[t._v("serverDidReady")]),t._v("）  创建启动定时任务")])]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220219140226.png",alt:"image-20220219140225050"}})]),t._v(" "),a("blockquote",[a("p",[t._v("通过"),a("code",[t._v("this.ctx.app")]),t._v("获取到app实例，在定时任务绑定数据到app的一个属性上")])]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220219140019.png",alt:"image-20220219140017830"}})]),t._v(" "),a("blockquote",[a("p",[t._v("在控制器添加方法渲染到app/view/index.html上")])]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220219140618.png",alt:"image-20220219140617171"}})]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220219140419.png",alt:"image-20220219140417001"}})]),t._v(" "),a("blockquote",[a("p",[t._v("在router.js启用路由")])]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220219140514.png",alt:"image-20220219140513319"}})]),t._v(" "),a("blockquote",[a("p",[t._v("访问test路由")])]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220219140646.png",alt:"image-20220219140645676"}})]),t._v(" "),a("h3",{attrs:{id:"框架扩展方法"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#框架扩展方法"}},[t._v("#")]),t._v(" 框架扩展方法")]),t._v(" "),a("p",[t._v("EggJS扩展\n默认情况下EggJS在Application、Context、 Request、 Response对象上提供了很多常用的方法给我们使用，但是有时候默认提供的这些方法可能不能满足我们的需求")]),t._v(" "),a("p",[t._v("此时我们就可以通过EggJS的扩展来给这些对象扩充自定义的方法\nhttps://eggjs.org/zh-cn/basics/extend.html")]),t._v(" "),a("p",[t._v("框架会把 "),a("code",[t._v("app/extend/application.js")]),t._v(" 中定义的对象与 Koa Application 的 prototype 对象进行合并，在应用启动时会基于扩展后的 prototype 生成 "),a("code",[t._v("app")]),t._v(" 对象。")]),t._v(" "),a("h4",{attrs:{id:"方法扩展"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#方法扩展"}},[t._v("#")]),t._v(" 方法扩展")]),t._v(" "),a("h5",{attrs:{id:"例如-我们要增加一个-app-foo-方法"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#例如-我们要增加一个-app-foo-方法"}},[t._v("#")]),t._v(" 例如，我们要增加一个 "),a("code",[t._v("app.foo()")]),t._v(" 方法：")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// app/extend/application.js")]),t._v("\nmodule"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("foo")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("param")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// this 就是 app 对象，在其中可以调用 app 上的其他方法，或访问属性")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("blockquote",[a("p",[t._v("创建app/extend/application.js")])]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220219141139.png",alt:"image-20220219141138668"}})]),t._v(" "),a("blockquote",[a("p",[t._v("在控制器中调用自定义方法")])]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220219141239.png",alt:"image-20220219141238560"}})]),t._v(" "),a("blockquote",[a("p",[t._v("在router.js启用路由")])]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220219140514.png",alt:"image-20220219140513319"}})]),t._v(" "),a("blockquote",[a("p",[t._v("路由访问test路由")]),t._v(" "),a("p",[t._v("控制台已经打印出来了")])]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220219141357.png",alt:"image-20220219141356555"}})]),t._v(" "),a("h5",{attrs:{id:"例如-我们要增加一个-ctx-foo-方法"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#例如-我们要增加一个-ctx-foo-方法"}},[t._v("#")]),t._v(" 例如，我们要增加一个 "),a("code",[t._v("ctx.foo()")]),t._v(" 方法：")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// app/extend/context.js")]),t._v("\nmodule"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("foo")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("param")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// this 就是 ctx 对象，在其中可以调用 ctx 上的其他方法，或访问属性")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("blockquote",[a("p",[t._v("创建app/extend/context.js")])]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220219141722.png",alt:"image-20220219141721135"}})]),t._v(" "),a("blockquote",[a("p",[t._v("在控制器中调用自定义方法")])]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220219141837.png",alt:"image-20220219141836219"}})]),t._v(" "),a("blockquote",[a("p",[t._v("在router定义test路由,然后访问")])]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220219141921.png",alt:"image-20220219141920709"}})]),t._v(" "),a("h5",{attrs:{id:"例如-增加一个-request-foo-属性-getter"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#例如-增加一个-request-foo-属性-getter"}},[t._v("#")]),t._v(" 例如，增加一个 "),a("code",[t._v("request.foo")]),t._v(" 属性 Getter：")]),t._v(" "),a("p",[t._v("框架会把 "),a("code",[t._v("app/extend/request.js")]),t._v(" 中定义的对象与内置 "),a("code",[t._v("request")]),t._v(" 的 prototype 对象进行合并，在处理请求时会基于扩展后的 prototype 生成 "),a("code",[t._v("request")]),t._v(" 对象。")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// app/extend/request.js")]),t._v("\nmodule"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("get")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("foo")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("get")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'x-request-foo'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220219142444.png",alt:"image-20220219142443741"}})]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220219142511.png",alt:"image-20220219142510529"}})]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220219142531.png",alt:"image-20220219142530009"}})]),t._v(" "),a("p",[t._v("框架会把 "),a("code",[t._v("app/extend/response.js")]),t._v(" 中定义的对象与内置 "),a("code",[t._v("response")]),t._v(" 的 prototype 对象进行合并，在处理请求时会基于扩展后的 prototype 生成 "),a("code",[t._v("response")]),t._v(" 对象。")]),t._v(" "),a("h5",{attrs:{id:"例如-增加一个-response-foo-属性-setter"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#例如-增加一个-response-foo-属性-setter"}},[t._v("#")]),t._v(" 例如，增加一个 "),a("code",[t._v("response.foo")]),t._v(" 属性 setter：")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// app/extend/response.js")]),t._v("\nmodule"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("set")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("foo")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("value")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("set")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'x-response-foo'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" value"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[t._v("就可以这样使用啦："),a("code",[t._v("this.response.foo = 'bar';")])]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220219142642.png",alt:"image-20220219142640158"}})]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220219142715.png",alt:"image-20220219142714136"}})]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220219142737.png",alt:"image-20220219142736000"}})]),t._v(" "),a("h3",{attrs:{id:"helper"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#helper"}},[t._v("#")]),t._v(" Helper")]),t._v(" "),a("p",[t._v("Helper 函数用来提供一些实用的 utility 函数。")]),t._v(" "),a("p",[t._v("它的作用在于我们可以将一些常用的动作抽离在 helper.js 里面成为一个独立的函数，这样可以用 JavaScript 来写复杂的逻辑，避免逻辑分散各处。另外还有一个好处是 Helper 这样一个简单的函数，可以让我们更容易编写测试用例。")]),t._v(" "),a("p",[t._v("框架内置了一些常用的 Helper 函数。我们也可以编写自定义的 Helper 函数。")]),t._v(" "),a("h4",{attrs:{id:"访问方式"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#访问方式"}},[t._v("#")]),t._v(" 访问方式")]),t._v(" "),a("p",[t._v("通过 "),a("code",[t._v("ctx.helper")]),t._v(" 访问到 helper 对象，例如：")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 假设在 app/router.js 中定义了 home routerapp.get('home', '/', 'home.index');")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 使用 helper 计算指定 url pathctx.helper.pathFor('home', { by: 'recent', limit: 20 });// => /?by=recent&limit=20")]),t._v("\n")])])]),a("h4",{attrs:{id:"扩展方式"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#扩展方式"}},[t._v("#")]),t._v(" 扩展方式")]),t._v(" "),a("p",[t._v("框架会把 "),a("code",[t._v("app/extend/helper.js")]),t._v(" 中定义的对象与内置 "),a("code",[t._v("helper")]),t._v(" 的 prototype 对象进行合并，在处理请求时会基于扩展后的 prototype 生成 "),a("code",[t._v("helper")]),t._v(" 对象。")]),t._v(" "),a("p",[t._v("例如，增加一个 "),a("code",[t._v("helper.foo()")]),t._v(" 方法：")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// app/extend/helper.js")]),t._v("\nmodule"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("foo")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("param")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// this 是 helper 对象，在其中可以调用其他 helper 方法")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// this.ctx => context 对象")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// this.app => application 对象")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220219143101.png",alt:"image-20220219143100390"}})]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220219143136.png",alt:"image-20220219143134916"}})]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220219143200.png",alt:"image-20220219143159001"}})]),t._v(" "),a("h3",{attrs:{id:"中间件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#中间件"}},[t._v("#")]),t._v(" 中间件")]),t._v(" "),a("p",[t._v("EggJS中间件\nEggJS是基于KOA的，所以EggJS的中间件形式和 Koa的中间件形式是一样的\n只不过EggJS规定我们需要将中间件写到特殊的目录中\n只不过EggJS中为中间件提供了多种使用方式\nhttps://eggjs.org/zh-cn/basics/middleware.html")]),t._v(" "),a("p",[t._v("一般来说中间件也会有自己的配置。在框架中，一个完整的中间件是包含了配置处理的。我们约定一个中间件是一个放置在 "),a("code",[t._v("app/middleware")]),t._v(" 目录下的单独文件，它需要 exports 一个普通的 function，接受两个参数：")]),t._v(" "),a("ul",[a("li",[t._v("options: 中间件的配置项，框架会将 "),a("code",[t._v("app.config[${middlewareName}]")]),t._v(" 传递进来。")]),t._v(" "),a("li",[t._v("app: 当前应用 Application 的实例。")])]),t._v(" "),a("blockquote",[a("p",[t._v("在app/middleware自定义中间件")])]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220219143702.png",alt:"image-20220219143700681"}})]),t._v(" "),a("blockquote",[a("p",[t._v("在全局使用中间件")])]),t._v(" "),a("p",[t._v("中间件编写完成后，我们还需要手动挂载，支持以下方式：")]),t._v(" "),a("h3",{attrs:{id:"在应用中使用中间件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#在应用中使用中间件"}},[t._v("#")]),t._v(" 在应用中使用中间件")]),t._v(" "),a("p",[t._v("在应用中，我们可以完全通过配置来加载自定义的中间件，并决定它们的顺序。")]),t._v(" "),a("p",[t._v("如果我们需要加载上面的 gzip 中间件，在 "),a("code",[t._v("config.default.js")]),t._v(" 中加入下面的配置就完成了中间件的开启和配置：")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("module"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 配置需要的中间件，数组顺序即为中间件的加载顺序  middleware: ['gzip'],")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 配置 gzip 中间件的配置  gzip: {    threshold: 1024, // 小于 1k 的响应体不压缩  },};")]),t._v("\n")])])]),a("p",[t._v("该配置最终将在启动时合并到 "),a("code",[t._v("app.config.appMiddleware")]),t._v("。")]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220219144240.png",alt:"image-20220219144239507"}})]),t._v(" "),a("p",[t._v("然后访问使用不同的浏览器访问test 例如： http://127.0.0.1:3000/test")]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220219144522.png",alt:"image-20220219144521595"}})]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220219144539.png",alt:"image-20220219144538471"}})]),t._v(" "),a("h3",{attrs:{id:"router-中使用中间件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#router-中使用中间件"}},[t._v("#")]),t._v(" router 中使用中间件")]),t._v(" "),a("p",[t._v("以上两种方式配置的中间件是全局的，会处理每一次请求。 如果你只想针对单个路由生效，可以直接在 "),a("code",[t._v("app/router.js")]),t._v(" 中实例化和挂载，如下：")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("module"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("exports")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("app")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" gzip "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" app"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("middleware"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("gzip")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("threshold")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1024")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  app"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("router"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("get")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/needgzip'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" gzip"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" app"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("controller"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("handler"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220219144947.png",alt:"image-20220219144945679"}})]),t._v(" "),a("h3",{attrs:{id:"国际化"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#国际化"}},[t._v("#")]),t._v(" 国际化")]),t._v(" "),a("p",[t._v("EggJS国际化(I18N)\n什么是国际化?国际化就是多语言，\n能够让你的网页在不同的国家显示不同的语言\n能够让你的网页支持语言切换\nhttps://www.eggjs.org/zh-CN/core/i18n")]),t._v(" "),a("h4",{attrs:{id:"编写-i18n-多语言文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#编写-i18n-多语言文件"}},[t._v("#")]),t._v(" 编写 I18n 多语言文件")]),t._v(" "),a("p",[t._v("多种语言的配置是独立的，统一存放在 "),a("code",[t._v("config/locale/*.js")]),t._v(" 下。")]),t._v(" "),a("div",{staticClass:"language-unknown extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("- config/locale/\n  - en-US.js\n  - zh-CN.js\n  - zh-TW.js\n")])])]),a("p",[t._v("不仅对于应用目录生效，在框架，插件的 "),a("code",[t._v("config/locale")]),t._v(" 目录下同样生效。")]),t._v(" "),a("p",[a("strong",[t._v("注意单词拼写，是 locale 不是 locals。")])]),t._v(" "),a("p",[t._v("例如：")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// config/locale/zh-CN.js")]),t._v("\nmodule"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("Email")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'邮箱'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[t._v("或者也可以用 JSON 格式的文件：")]),t._v(" "),a("div",{staticClass:"language-json extra-class"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// config/locale/zh-CN.json")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"Email"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"邮箱"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220219145406.png",alt:"image-20220219145405118"}})]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220219145443.png",alt:"image-20220219145442337"}})]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220219145552.png",alt:"image-20220219145551641"}})]),t._v(" "),a("h4",{attrs:{id:"切换语言"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#切换语言"}},[t._v("#")]),t._v(" 切换语言")]),t._v(" "),a("blockquote",[a("p",[t._v("我们可以通过下面几种方式修改应用的当前语言（修改后会记录到 "),a("code",[t._v("locale")]),t._v(" 这个 Cookie），下次请求直接用设定好的语言。")])]),t._v(" "),a("p",[t._v("优先级从高到低：")]),t._v(" "),a("ol",[a("li",[t._v("query: "),a("code",[t._v("/?locale=en-US")])]),t._v(" "),a("li",[t._v("cookie: "),a("code",[t._v("locale=zh-TW")])]),t._v(" "),a("li",[t._v("header: "),a("code",[t._v("Accept-Language: zh-CN,zh;q=0.5")])])]),t._v(" "),a("p",[t._v("如果想修改 query 或者 Cookie 参数名称：")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// config/config.default.js")]),t._v("\nexports"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("i18n "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("queryField")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'locale'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("cookieField")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'locale'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Cookie 默认一年后过期， 如果设置为 Number，则单位为 ms")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("cookieMaxAge")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'1y'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("blockquote",[a("p",[t._v("使用获取多语言文本")])]),t._v(" "),a("p",[t._v("我们可以使用 "),a("code",[t._v("__")]),t._v(" (Alias: "),a("code",[t._v("gettext")]),t._v(") 函数获取 locale 文件夹下面的多语言文本。")]),t._v(" "),a("p",[a("strong",[t._v("注意: "),a("code",[t._v("__")]),t._v(" 是两个下划线")])]),t._v(" "),a("p",[t._v("以上面配置过的多语言为例：")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("ctx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("__")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Email'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// zh-CN => 邮箱")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// en-US => Email")]),t._v("\n")])])]),a("p",[t._v("如果文本中含有 "),a("code",[t._v("%s")]),t._v("，"),a("code",[t._v("%j")]),t._v(" 等 format 函数，可以按照 "),a("a",{attrs:{href:"https://nodejs.org/api/util.html#util_util_format_format_args",target:"_blank",rel:"noopener noreferrer"}},[a("code",[t._v("util.format()")]),a("OutboundLink")],1),t._v(" 类似的方式调用：")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// config/locale/zh-CN.jsmodule.exports = {  'Welcome back, %s!': '欢迎回来，%s!',};")]),t._v("\nctx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("__")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Welcome back, %s!'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Shawn'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// zh-CN => 欢迎回来，Shawn!// en-US => Welcome back, Shawn!")]),t._v("\n")])])]),a("p",[t._v("同时支持数组下标占位符方式，例如：")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// config/locale/zh-CN.jsmodule.exports = {  'Hello {0}! My name is {1}.': '你好 {0}! 我的名字叫 {1}。',};")]),t._v("\nctx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("__")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Hello {0}! My name is {1}.'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'foo'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'bar'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// zh-CN => 你好 foo！我的名字叫 bar。// en-US => Hello foo! My name is bar.")]),t._v("\n")])])]),a("blockquote",[a("p",[t._v("比如之前我们动态渲染的那个index.html")])]),t._v(" "),a("p",[t._v("在控制渲染 "),a("code",[t._v("msg")]),t._v("为"),a("code",[t._v("this.ctx__('Email')")])]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220219150120.png",alt:"image-20220219150119063"}})]),t._v(" "),a("blockquote",[a("p",[t._v("在router.js启用路由")])]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220219140514.png",alt:"image-20220219140513319"}})]),t._v(" "),a("blockquote",[a("p",[t._v("访问"),a("code",[t._v("test?locale=en-US")]),t._v(" 或 "),a("code",[t._v("test?locale=zh-CN")]),t._v("来切换")])]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220219150457.png",alt:"image-20220219150456279"}})]),t._v(" "),a("p",[t._v("每次保存在Cookie中")]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220219145908.png",alt:"image-20220219145906188"}})]),t._v(" "),a("h3",{attrs:{id:"操作mysql"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#操作mysql"}},[t._v("#")]),t._v(" 操作mysql")]),t._v(" "),a("p",[t._v("EggJS如何操作MySQL\nhttps://www.eggjs.org/zh-CN/tutorials/mysql")]),t._v(" "),a("h4",{attrs:{id:"安装和配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装和配置"}},[t._v("#")]),t._v(" 安装和配置")]),t._v(" "),a("p",[t._v("安装对应的插件 "),a("a",{attrs:{href:"https://github.com/eggjs/egg-mysql",target:"_blank",rel:"noopener noreferrer"}},[t._v("egg-mysql"),a("OutboundLink")],1),t._v(" ：")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("npm")]),t._v(" i --save egg-mysql\n")])])]),a("p",[t._v("开启插件：")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// config/plugin.js")]),t._v("\nexports"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("mysql "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("enable")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("package")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'egg-mysql'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220219151007.png",alt:"image-20220219151006033"}})]),t._v(" "),a("p",[t._v("在 "),a("code",[t._v("config/config.${env}.js")]),t._v(" 配置各个环境的数据库连接信息。")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// config/config.${env}.js")]),t._v("\nexports"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("mysql "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 单数据库信息配置")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("client")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// host")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("host")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'mysql.com'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 端口号")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("port")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'3306'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 用户名")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("user")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'test_user'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 密码")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("password")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'test_password'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 数据库名")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("database")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'test'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 是否加载到 app 上，默认开启")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("app")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 是否加载到 agent 上，默认关闭")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("agent")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220219151150.png",alt:"image-20220219151149588"}})]),t._v(" "),a("h4",{attrs:{id:"创建一个路由来测试"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#创建一个路由来测试"}},[t._v("#")]),t._v(" 创建一个路由来测试")]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220219151539.png",alt:"image-20220219151538071"}})]),t._v(" "),a("h4",{attrs:{id:"创建一个控制器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#创建一个控制器"}},[t._v("#")]),t._v(" 创建一个控制器")]),t._v(" "),a("blockquote",[a("p",[t._v("添加insert方法插入数据库，向service传入路由传过来的信息，然后等到返回结果判断是否插入成功")])]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220219151831.png",alt:"image-20220219151829954"}})]),t._v(" "),a("h4",{attrs:{id:"创建一个service"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#创建一个service"}},[t._v("#")]),t._v(" 创建一个service")]),t._v(" "),a("h5",{attrs:{id:"如何编写-crud-语句"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#如何编写-crud-语句"}},[t._v("#")]),t._v(" 如何编写 CRUD 语句")]),t._v(" "),a("p",[t._v("下面的语句若没有特殊注明，默认都书写在 "),a("code",[t._v("app/service")]),t._v(" 下。")]),t._v(" "),a("h6",{attrs:{id:"create"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#create"}},[t._v("#")]),t._v(" Create")]),t._v(" "),a("p",[t._v("可以直接使用 "),a("code",[t._v("insert")]),t._v(" 方法插入一条记录。")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 插入")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" result "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("app"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("mysql"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("insert")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'posts'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("title")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Hello World'")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 在 post 表中，插入 title 为 Hello World 的记录")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("INSERT")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("INTO")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token template-string"}},[a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("posts")]),a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token template-string"}},[a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("title")]),a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("VALUES")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Hello World'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\nconsole"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("result"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("fieldCount")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("affectedRows")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("insertId")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3710")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("serverStatus")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("warningCount")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("message")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("''")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("protocol41")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("changedRows")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 判断插入成功")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" insertSuccess "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" result"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("affectedRows "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("h6",{attrs:{id:"read"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#read"}},[t._v("#")]),t._v(" Read")]),t._v(" "),a("p",[t._v("可以直接使用 "),a("code",[t._v("get")]),t._v(" 方法或 "),a("code",[t._v("select")]),t._v(" 方法获取一条或多条记录。"),a("code",[t._v("select")]),t._v(" 方法支持条件查询与结果的定制。")]),t._v(" "),a("ul",[a("li",[t._v("查询一条记录")])]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" post "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("app"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("mysql"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("get")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'posts'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("id")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("12")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("SELECT")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("FROM")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token template-string"}},[a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("posts")]),a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("WHERE")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token template-string"}},[a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("id")]),a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("12")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("LIMIT")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("ul",[a("li",[t._v("查询全表")])]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" results "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("app"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("mysql"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("select")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'posts'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("SELECT")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("FROM")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token template-string"}},[a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("posts")]),a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("ul",[a("li",[t._v("条件查询和结果定制")])]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" results "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("app"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("mysql"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("select")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'posts'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 搜索 post 表")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("where")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("status")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'draft'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("author")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'author1'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'author2'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// WHERE 条件")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("columns")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'author'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'title'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 要查询的表字段")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("orders")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'created_at'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'desc'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'id'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'desc'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 排序方式")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("limit")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 返回数据量")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("offset")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 数据偏移量")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("SELECT")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token template-string"}},[a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("author")]),a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token template-string"}},[a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("title")]),a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("FROM")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token template-string"}},[a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("posts")]),a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("WHERE")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token template-string"}},[a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("status")]),a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'draft'")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("AND")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token template-string"}},[a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("author")]),a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("IN")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'author1'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'author2'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("ORDER")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("BY")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token template-string"}},[a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("created_at")]),a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("DESC")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token template-string"}},[a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("id")]),a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("DESC")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("LIMIT")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("h6",{attrs:{id:"update"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#update"}},[t._v("#")]),t._v(" Update")]),t._v(" "),a("p",[t._v("可以直接使用 "),a("code",[t._v("update")]),t._v(" 方法更新数据库记录。")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 修改数据，将会根据主键 ID 查找，并更新")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" row "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("id")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("123")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'fengmk2'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("otherField")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'other field value'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// any other fields u want to update")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("modifiedAt")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("app"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("mysql"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("literals"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("now"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// `now()` on db server")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" result "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("app"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("mysql"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("update")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'posts'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" row"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 更新 posts 表中的记录")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("UPDATE")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token template-string"}},[a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("posts")]),a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("SET")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token template-string"}},[a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'fengmk2'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token template-string"}},[a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("modifiedAt")]),a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("NOW")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("WHERE")]),t._v(" id "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("123")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 判断更新成功")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" updateSuccess "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" result"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("affectedRows "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 如果主键是自定义的 ID 名称，如 custom_id，则需要在 `where` 里面配置")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" row "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'fengmk2'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("otherField")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'other field value'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// any other fields u want to update")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("modifiedAt")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("app"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("mysql"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("literals"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("now"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// `now()` on db server")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" options "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("where")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("custom_id")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("456")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" result "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("app"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("mysql"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("update")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'posts'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" row"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" options"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 更新 posts 表中的记录")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("UPDATE")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token template-string"}},[a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("posts")]),a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("SET")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token template-string"}},[a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'fengmk2'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token template-string"}},[a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("modifiedAt")]),a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("NOW")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("WHERE")]),t._v(" custom_id "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("456")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 判断更新成功")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" updateSuccess "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" result"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("affectedRows "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("h6",{attrs:{id:"delete"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#delete"}},[t._v("#")]),t._v(" Delete")]),t._v(" "),a("p",[t._v("可以直接使用 "),a("code",[t._v("delete")]),t._v(" 方法删除数据库记录。")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" result "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("app"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("mysql"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("delete")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'posts'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("author")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'fengmk2'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("DELETE")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("FROM")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token template-string"}},[a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("posts")]),a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("WHERE")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token template-string"}},[a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("author")]),a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'fengmk2'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220219152248.png",alt:"image-20220219152247058"}})]),t._v(" "),a("h3",{attrs:{id:"sequelize"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#sequelize"}},[t._v("#")]),t._v(" Sequelize")]),t._v(" "),a("p",[t._v("https://www.eggjs.org/zh-CN/tutorials/sequelize")]),t._v(" "),a("h4",{attrs:{id:"安装和配置-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装和配置-2"}},[t._v("#")]),t._v(" 安装和配置")]),t._v(" "),a("ul",[a("li",[t._v("安装")])]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("npm")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" --save egg-sequelize mysql2\n")])])]),a("ul",[a("li",[t._v("在 "),a("code",[t._v("config/plugin.js")]),t._v(" 中引入 egg-sequelize 插件")])]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("exports"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("sequelize "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("enable")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("package")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'egg-sequelize'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220219153332.png",alt:"image-20220219153330642"}})]),t._v(" "),a("ul",[a("li",[t._v("在 "),a("code",[t._v("config/config.default.js")]),t._v(" 中编写 sequelize 配置")])]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("exports"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("sequelize "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("dialect")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'mysql'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("host")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'127.0.0.1'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("port")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3306")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("database")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'egg-sequelize-doc-default'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220219153538.png",alt:"image-20220219153536605"}})]),t._v(" "),a("h4",{attrs:{id:"创建模型"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#创建模型"}},[t._v("#")]),t._v(" 创建模型")]),t._v(" "),a("p",[t._v("现在终于可以开始编写代码实现业务逻辑了，首先我们来在 "),a("code",[t._v("app/model/")]),t._v(" 目录下编写 user 这个 Model：")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'use strict'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\nmodule"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("exports")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("app")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("STRING")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("INTEGER")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("DATE")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" app"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Sequelize"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" User "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" app"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("model"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("define")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'user'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("id")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("type")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("INTEGER")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("primaryKey")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("autoIncrement")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("STRING")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("30")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("age")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("INTEGER")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("created_at")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("DATE")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("updated_at")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("DATE")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" User"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220219153835.png",alt:"image-20220219153834738"}})]),t._v(" "),a("h4",{attrs:{id:"操作数据库"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#操作数据库"}},[t._v("#")]),t._v(" 操作数据库")]),t._v(" "),a("p",[t._v("这个 Model 就可以在 Controller 和 Service 中通过 "),a("code",[t._v("app.model.User")]),t._v(" 或者 "),a("code",[t._v("ctx.model.User")]),t._v(" 访问到了，例如我们编写 "),a("code",[t._v("app/controller/users.js")]),t._v("：")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// app/controller/users.js")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" Controller "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'egg'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Controller"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("toInt")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("str")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("typeof")]),t._v(" str "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'number'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" str"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("str"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" str"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("parseInt")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("str"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("UserController")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("extends")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Controller")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("async")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("index")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" ctx "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ctx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" query "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("limit")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("toInt")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ctx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("query"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("limit"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("offset")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("toInt")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ctx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("query"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("offset"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    ctx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("body "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" ctx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("model"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("User"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("findAll")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("query"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("async")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("show")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" ctx "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ctx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    ctx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("body "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" ctx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("model"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("User"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("findByPk")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("toInt")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ctx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("params"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("async")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("create")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" ctx "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ctx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" age "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" ctx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("request"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("body"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" user "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" ctx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("model"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("User"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("create")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" age "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    ctx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("status "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("201")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    ctx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("body "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" user"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("async")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("update")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" ctx "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ctx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" id "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("toInt")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ctx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("params"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" user "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" ctx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("model"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("User"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("findByPk")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("user"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      ctx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("status "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("404")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" age "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" ctx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("request"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("body"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" user"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("update")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" age "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    ctx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("body "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" user"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("async")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("destroy")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" ctx "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ctx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" id "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("toInt")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ctx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("params"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" user "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" ctx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("model"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("User"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("findByPk")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("user"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      ctx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("status "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("404")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" user"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("destroy")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    ctx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("status "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("200")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\nmodule"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" UserController"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("blockquote",[a("p",[t._v("在控制器进行操作")])]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220219154201.png",alt:"image-20220219154200125"}})]),t._v(" "),a("blockquote",[a("p",[t._v("具体的数据操作在serivce")])]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220219154418.png",alt:"image-20220219154417319"}})]),t._v(" "),a("blockquote",[a("p",[t._v("数据成功返回")])]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220219154643.png",alt:"image-20220219154641084"}})]),t._v(" "),a("blockquote",[a("p",[t._v("数据库插入成功")])]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220219154612.png",alt:"image-20220219154611370"}})]),t._v(" "),a("h3",{attrs:{id:"eggjs配置文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#eggjs配置文件"}},[t._v("#")]),t._v(" EggJS配置文件")]),t._v(" "),a("p",[t._v("EggJS给我们提供了多种配置文件，方便我们在不同的阶段中使用")]),t._v(" "),a("ol",[a("li",[t._v("config.prod.js//只有线上环境会加载")]),t._v(" "),a("li",[t._v("config.test.js//只有测试环境会加载")]),t._v(" "),a("li",[t._v("config.local.js//只有开发环境会加载")]),t._v(" "),a("li",[t._v("config.default.js // 所有环境都会加载")])]),t._v(" "),a("blockquote",[a("p",[t._v("如果出现同名的配置，后面三个配置文件中的配置会覆盖default中的配置")]),t._v(" "),a("p",[t._v("https://eggjs.org/zh-cn/basics/config.html")])]),t._v(" "),a("p",[t._v("2.如何设置当前环境?")]),t._v(" "),a("p",[t._v("EGG SERVER ENV=xxx\nhttps://eggjs.org/zh-cn/basics/env.html")]),t._v(" "),a("p",[t._v("框架有两种方式指定运行环境：")]),t._v(" "),a("p",[t._v("1.通过  "),a("code",[t._v("config/env")]),t._v(" 文件指定，该文件的内容就是运行环境，如 "),a("code",[t._v("prod")]),t._v("。一般通过构建工具来生成这个文件。")]),t._v(" "),a("div",{staticClass:"language-unknown extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("// config/env\nprod\n")])])]),a("p",[t._v("2.通过 "),a("code",[t._v("EGG_SERVER_ENV")]),t._v(" 环境变量指定运行环境更加方便，比如在生产环境启动应用：")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("EGG_SERVER_ENV")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("prod "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("npm")]),t._v(" start\n")])])]),a("blockquote",[a("p",[t._v("为了兼容平台使用cross-env")])]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("npm")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" cross-env\n")])])]),a("blockquote",[a("p",[t._v("修改package.json")])]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220219155855.png",alt:"image-20220219155847317"}})]),t._v(" "),a("blockquote",[a("p",[t._v("但是上线阶段并不是使用egg-bin，而是egg-scripts")])]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("npm")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" egg-scripts --save\n")])])]),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220219160045.png",alt:"image-20220219160044304"}})]),t._v(" "),a("blockquote",[a("p",[t._v("新建上线和开发阶段的配置文件")])]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220219160159.png",alt:"image-20220219160157803"}})]),t._v(" "),a("p",[t._v("上线阶段连接上线阶段的数据库")]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220219160315.png",alt:"image-20220219160314320"}})]),t._v(" "),a("p",[t._v("开发阶段连接开发阶段的数据库")]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220219160412.png",alt:"image-20220219160410961"}})]),t._v(" "),a("h3",{attrs:{id:"脚手架工具"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#脚手架工具"}},[t._v("#")]),t._v(" 脚手架工具")]),t._v(" "),a("blockquote",[a("p",[t._v("安装脚手架")])]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("npm i egg"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("init "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("g\n")])])]),a("p",[t._v("我们推荐直接使用脚手架，只需几条简单指令，即可快速生成项目（"),a("code",[t._v("npm >=6.1.0")]),t._v("）:")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("mkdir")]),t._v(" egg-example "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" egg-example\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("npm")]),t._v(" init egg --type"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("simple\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("npm")]),t._v(" i\n")])])]),a("p",[t._v("启动项目:")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("npm")]),t._v(" run dev\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("open")]),t._v(" http://localhost:7001\n")])])]),a("blockquote",[a("p",[t._v("如何通过EggJS的脚手架来创建Egg项目")])]),t._v(" "),a("ol",[a("li",[t._v("在全局安装脚手架工具npm i egg-init -g")]),t._v(" "),a("li",[t._v("新建一个项目文件夹，在这个文件夹中执行npm init egg --type=simple")]),t._v(" "),a("li",[t._v("执行初始化指令之后全程回车(也可以输入内容 项目名称/项目描述/项目作者)")]),t._v(" "),a("li",[t._v("进入项目文件夹，执行npm install 安装相关的依赖")]),t._v(" "),a("li",[t._v("可以通过npm run dev / npm run test / npm run start运行项目")])]),t._v(" "),a("blockquote",[a("p",[t._v("run dev 在开发模式下运行")]),t._v(" "),a("p",[t._v("run test 在调试模式下运行")]),t._v(" "),a("p",[t._v("run start 在上线环境中运行")])]),t._v(" "),a("h3",{attrs:{id:"csrf防范"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#csrf防范"}},[t._v("#")]),t._v(" CSRF防范")]),t._v(" "),a("h4",{attrs:{id:"实现注册和登录"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#实现注册和登录"}},[t._v("#")]),t._v(" 实现注册和登录")]),t._v(" "),a("blockquote",[a("p",[t._v("路由写个测试的注册")])]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220219162656.png",alt:"image-20220219162655112"}})]),t._v(" "),a("blockquote",[a("p",[t._v("在控制器打印一下提交的参数")])]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220219163442.png",alt:"image-20220219163441386"}})]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220219163353.png",alt:"image-20220219163352591"}})]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220219163403.png",alt:"image-20220219163402521"}})]),t._v(" "),a("h5",{attrs:{id:"同步表单的-csrf-校验"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#同步表单的-csrf-校验"}},[t._v("#")]),t._v(" 同步表单的 CSRF 校验")]),t._v(" "),a("p",[t._v("在同步渲染页面时，在表单请求中增加一个 name 为 "),a("code",[t._v("_csrf")]),t._v(" 的 url query，值为 "),a("code",[t._v("ctx.csrf")]),t._v("，这样用户在提交这个表单的时候会将 CSRF token 提交上来：")]),t._v(" "),a("div",{staticClass:"language-html extra-class"},[a("pre",{pre:!0,attrs:{class:"language-html"}},[a("code",[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("form")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("method")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("POST"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("action")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("/upload?_csrf={{ ctx.csrf | safe }}"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("enctype")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("multipart/form-data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  title: "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("input")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("title"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("/>")])]),t._v(" file: "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("input")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("file"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("type")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("file"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("/>")])]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("button")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("type")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("submit"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("upload"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("button")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("form")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])])]),a("blockquote",[a("p",[t._v("参数的值在Cookie里")])]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220219163126.png",alt:"image-20220219163125435"}})]),t._v(" "),a("blockquote",[a("p",[t._v("现在尝试注册")])]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220219163245.png",alt:"image-20220219163243917"}})]),t._v(" "),a("p",[t._v("虽然"),a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220219163155.png",alt:"image-20220219163153712"}})]),t._v(" "),a("blockquote",[a("p",[t._v("但是控制台打印出来")])]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220219163041.png",alt:"image-20220219163040287"}})]),t._v(" "),a("h4",{attrs:{id:"合理处理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#合理处理"}},[t._v("#")]),t._v(" 合理处理")]),t._v(" "),a("p",[t._v("写死不太好，改回来")]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220219163632.png",alt:"image-20220219163631638"}})]),t._v(" "),a("h5",{attrs:{id:"ajax-请求"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ajax-请求"}},[t._v("#")]),t._v(" AJAX 请求")]),t._v(" "),a("p",[t._v("在 CSRF 默认配置下，token 会被设置在 Cookie 中，在 AJAX 请求的时候，可以从 Cookie 中取到 token，放置到 query、body 或者 header 中发送给服务端。")]),t._v(" "),a("p",[t._v("In jQuery:")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" csrftoken "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Cookies"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("get")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'csrfToken'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("csrfSafeMethod")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("method")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// these HTTP methods do not require CSRF protection")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token regex"}},[a("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token regex-source language-regex"}},[t._v("^(GET|HEAD|OPTIONS|TRACE)$")]),a("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[t._v("/")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("test")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("method"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n$"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("ajaxSetup")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("beforeSend")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("xhr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" settings")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("csrfSafeMethod")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("settings"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("type"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("crossDomain"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      xhr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("setRequestHeader")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'x-csrf-token'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" csrftoken"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("h4",{attrs:{id:"例子-在jquery中"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#例子-在jquery中"}},[t._v("#")]),t._v(" 例子：在JQuery中")]),t._v(" "),a("blockquote",[a("p",[t._v("获取Cookie")])]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220219164101.png",alt:"image-20220219164100235"}})]),t._v(" "),a("blockquote",[a("p",[t._v("动态设置csrfToken")])]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220219164142.png",alt:"image-20220219164138645"}})]),t._v(" "),a("h3",{attrs:{id:"校验前端数据"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#校验前端数据"}},[t._v("#")]),t._v(" 校验前端数据")]),t._v(" "),a("blockquote",[a("p",[t._v("安装")])]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("npm")]),t._v(" i egg-ajv --save\n")])])]),a("blockquote",[a("p",[t._v("在配置文件中启用")])]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("exports"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ajv "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("enable")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("package")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'egg-ajv'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220219164726.png",alt:"image-20220219164724903"}})]),t._v(" "),a("blockquote",[a("p",[t._v("在config.default.js配置")])]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("config"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ajv "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("keyword")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'schema'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// to indicate the namespace and path of schemas, default as 'schema'")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("allErrors")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// required for custom error message")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("jsonPointers")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// required for custom error message")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220219165108.png",alt:"image-20220219165106881"}})]),t._v(" "),a("blockquote",[a("p",[t._v("schema")])]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// app/schema/definition.js")]),t._v("\n \nmodule"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("int")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("type")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'integer'")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("str")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("type")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'string'")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// app/schema/user.js")]),t._v("\n \nmodule"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("properties")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("id")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("$ref")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'schema.definition#/int'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("type")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'string'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("password")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("type")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'string'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("required")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'name'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'password'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'id'")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("$async")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("additionalProperties")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// app/controller/user.js")]),t._v("\n \nexports"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("create")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("async")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("ctx")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ctx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("validate")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'schema.pagination'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ctx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("request"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("body"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("blockquote",[a("p",[t._v("在app/schema/user.js写个schame")])]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220219165605.png",alt:"image-20220219165604133"}})]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220219165632.png",alt:"image-20220219165631094"}})]),t._v(" "),a("blockquote",[a("p",[t._v("回到user控制器校验")])]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220219165455.png",alt:"image-20220219165454790"}})]),t._v(" "),a("p",[a("code",[t._v("schema.user")]),t._v("中的"),a("code",[t._v("user")]),t._v("是文件名，"),a("code",[t._v("this.ctx.request.body")]),t._v("是表单提交过来的数据")]),t._v(" "),a("blockquote",[a("p",[t._v("注册进行校验")])]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220219165819.png",alt:"image-20220219165818327"}})]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220219165846.png",alt:"image-20220219165844822"}})]),t._v(" "),a("h3",{attrs:{id:"统一接口响应格式"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#统一接口响应格式"}},[t._v("#")]),t._v(" 统一接口响应格式")]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220219170156.png",alt:"image-20220219170155132"}})]),t._v(" "),a("p",[t._v("比如控制中返回给前端的数据，要统一下")]),t._v(" "),a("p",[t._v("上面说过扩展ctx的方法和扩展工具的方法")]),t._v(" "),a("blockquote",[a("p",[t._v("先扩展工具的方法，用来处理状态码对应的信息")])]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220219170523.png",alt:"image-20220219170521018"}})]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220219170552.png",alt:"image-20220219170550769"}})]),t._v(" "),a("blockquote",[a("p",[t._v("继续写ctx的扩展 成功和失败的返回的格式")])]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220219170824.png",alt:"image-20220219170822065"}})]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220219170746.png",alt:"image-20220219170744597"}})]),t._v(" "),a("blockquote",[a("p",[t._v("然后就可以在控制器里面这样写")])]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220219170936.png",alt:"image-20220219170934942"}})]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220219170953.png",alt:"image-20220219170952121"}})]),t._v(" "),a("h3",{attrs:{id:"保存注册数据"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#保存注册数据"}},[t._v("#")]),t._v(" 保存注册数据")]),t._v(" "),a("blockquote",[a("p",[t._v("继续回到控制器，把成功之后的结果用service存到数据库当中")])]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220219172046.png",alt:"image-20220219172043944"}})]),t._v(" "),a("blockquote",[a("p",[t._v("编写service")])]),t._v(" "),a("p",[t._v("当然要安装sequelize mysql2 ，前面都有这里略过")]),t._v(" "),a("p",[t._v("这里model进行第三次检验")]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220219171635.png",alt:"image-20220219171634305"}})]),t._v(" "),a("p",[t._v("service")]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220219171928.png",alt:"image-20220219171927626"}})]),t._v(" "),a("h3",{attrs:{id:"加密工具封装"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#加密工具封装"}},[t._v("#")]),t._v(" 加密工具封装")]),t._v(" "),a("blockquote",[a("p",[t._v("扩展工具helper")])]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220219172612.png",alt:"image-20220219172610477"}})]),t._v(" "),a("blockquote",[a("p",[t._v("这个地方写错了应该是this._md5")])]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220219172929.png",alt:"image-20220219172927993"}})]),t._v(" "),a("p",[t._v("然后在注册的service进行密码加密")]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220219172810.png",alt:"image-20220219172809436"}})]),t._v(" "),a("h3",{attrs:{id:"防止重复注册"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#防止重复注册"}},[t._v("#")]),t._v(" 防止重复注册")]),t._v(" "),a("blockquote",[a("p",[t._v("创建表的时候就设置用户名UNIQUE")])]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220219173126.png",alt:"image-20220219173125473"}})]),t._v(" "),a("blockquote",[a("p",[t._v("要么修改service")])]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220219173539.png",alt:"image-20220219173538009"}})]),t._v(" "),a("h3",{attrs:{id:"实现登录"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#实现登录"}},[t._v("#")]),t._v(" 实现登录")]),t._v(" "),a("blockquote",[a("p",[t._v("修改前端的请求")])]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220219173947.png",alt:"image-20220219173946654"}})]),t._v(" "),a("blockquote",[a("p",[t._v("路由监听login")])]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220219174012.png",alt:"image-20220219174010838"}})]),t._v(" "),a("blockquote",[a("p",[t._v("控制器user新增login方法进行测试")])]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220219174258.png",alt:"image-20220219174257109"}})]),t._v(" "),a("blockquote",[a("p",[t._v("service新增查找用户")])]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220219174821.png",alt:"image-20220219174820315"}})]),t._v(" "),a("blockquote",[a("p",[t._v("修改一下，防止user为null")])]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220219175142.png",alt:"image-20220219175140416"}})]),t._v(" "),a("h3",{attrs:{id:"保存登录状态-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#保存登录状态-2"}},[t._v("#")]),t._v(" 保存登录状态")]),t._v(" "),a("p",[t._v("sessionStore 的实现我们也可以封装到插件中，例如 "),a("a",{attrs:{href:"https://github.com/eggjs/egg-session-redis",target:"_blank",rel:"noopener noreferrer"}},[t._v("egg-session-redis"),a("OutboundLink")],1),t._v(" 就提供了将 Session 存储到 redis 中的能力，在应用层，我们只需要引入 "),a("a",{attrs:{href:"https://github.com/eggjs/egg-redis",target:"_blank",rel:"noopener noreferrer"}},[t._v("egg-redis"),a("OutboundLink")],1),t._v(" 和 "),a("a",{attrs:{href:"https://github.com/eggjs/egg-session-redis",target:"_blank",rel:"noopener noreferrer"}},[t._v("egg-session-redis"),a("OutboundLink")],1),t._v(" 插件即可。")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// plugin.js")]),t._v("\nexports"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("redis "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("enable")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("package")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'egg-redis'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nexports"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("sessionRedis "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("enable")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("package")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'egg-session-redis'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[a("strong",[t._v("注意：一旦选择了将 Session 存入到外部存储中，就意味着系统将强依赖于这个外部存储，当它挂了的时候，我们就完全无法使用 Session 相关的功能了。因此我们更推荐大家只将必要的信息存储在 Session 中，保持 Session 的精简并使用默认的 Cookie 存储，用户级别的缓存不要存储在 Session 中。")])]),t._v(" "),a("blockquote",[a("p",[t._v("安装")])]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("npm")]),t._v(" i egg-session-redis egg-redis --save\n")])])]),a("blockquote",[a("p",[t._v("配置")])]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// {app_root}/config/plugin.js")]),t._v("\nexports"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("sessionRedis "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("enable")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("package")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'egg-session-redis'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n \nexports"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("redis "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("enable")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("package")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'egg-redis'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220219175924.png",alt:"image-20220219175923695"}})]),t._v(" "),a("blockquote",[a("p",[t._v("配置config.default.js")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("// {app_root}/config/config.default.js\nexports.redis = {\n  client: {\n    host: 'your redis host',\n    port: 'your redis port',\n    password: '',\n    db: '0',\n  },\n  agent:true\n};\n// no need to set any sessionRedis config\n")])])]),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220219180426.png",alt:"image-20220219180425664"}})]),t._v(" "),a("blockquote",[a("p",[t._v("在登陆的时候保存到session中的user(自定义的属性) ,session自动保存到redis")])]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220219180736.png",alt:"image-20220219180735307"}})]),t._v(" "),a("h3",{attrs:{id:"单元测试"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#单元测试"}},[t._v("#")]),t._v(" 单元测试")]),t._v(" "),a("blockquote",[a("p",[t._v("1.什么是单元测试?")])]),t._v(" "),a("p",[t._v("单元测试是指对软件中的最小可测试单元进行检查和验证")]),t._v(" "),a("blockquote",[a("p",[t._v("2.什么是最小可测试单元?")])]),t._v(" "),a("p",[t._v("一个函数，一个类，个文件，这些都可以称之为最小可测试单元\n具体需要根据实际情况去判定其具体含义，一般情况下我们以函数作为最小单元即可")]),t._v(" "),a("blockquote",[a("p",[t._v("3.单元测试有什么用?")])]),t._v(" "),a("p",[t._v("保证代码的正确性\n保存程序的稳定性\n增强自信心\n公司领导要求(红绿灯)")]),t._v(" "),a("blockquote",[a("p",[t._v("4.在EggJS中如何进行单元测试")])]),t._v(" "),a("blockquote",[a("p",[t._v("4.1EggJS使用Mocha测试框架和power-assert断言库来进行单元测试")])]),t._v(" "),a("p",[t._v("Mocha :\nhttps://mochajs.org/\n作用:提供了编写测试代码的方法\npower-assert: https://github.com/power-assert-js/power-assert\n作用:判断测试结果是否正确")]),t._v(" "),a("blockquote",[a("p",[t._v("4.2EggJS还抽取了一个叫做egg mock的辅助模块，配合Mocha和power -assert进行测试")])]),t._v(" "),a("p",[t._v("egg-mock: https://www.npmjs.com/package/egg-mock\n作用:帮助我们能够在单元测试中模拟app,context, cookie, session, 网络请求等")]),t._v(" "),a("blockquote",[a("p",[t._v("4.3EggJS规定了测试文件的存放路径和文件名称")])]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220219201719.png",alt:"image-20220219201717877"}})]),t._v(" "),a("blockquote",[a("p",[t._v("4.4EggJS规定我们使用"),a("code",[t._v("egg-bin test")]),t._v("来运行我们编写的测试文件")])]),t._v(" "),a("h3",{attrs:{id:"测试库模块和生命周期钩子函数"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#测试库模块和生命周期钩子函数"}},[t._v("#")]),t._v(" 测试库模块和生命周期钩子函数")]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220219202759.png",alt:"image-20220219202757671"}})]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220219203249.png",alt:"image-20220219203247495"}})]),t._v(" "),a("h3",{attrs:{id:"同步测试和异步测试"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#同步测试和异步测试"}},[t._v("#")]),t._v(" 同步测试和异步测试")]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220219204110.png",alt:"image-20220219204108065"}})]),t._v(" "),a("h3",{attrs:{id:"测试控制器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#测试控制器"}},[t._v("#")]),t._v(" 测试控制器")]),t._v(" "),a("blockquote",[a("p",[t._v("test文件夹里的目录必须和app里面一样的")])]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220219205313.png",alt:"image-20220219205312216"}})]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220219205156.png",alt:"image-20220219205155216"}})]),t._v(" "),a("h3",{attrs:{id:"测试service"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#测试service"}},[t._v("#")]),t._v(" 测试Service")]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220219205417.png",alt:"image-20220219205416054"}})]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220219205928.png",alt:"image-20220219205926461"}})]),t._v(" "),a("h3",{attrs:{id:"测试扩展-application"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#测试扩展-application"}},[t._v("#")]),t._v(" 测试扩展 application")]),t._v(" "),a("blockquote",[a("p",[t._v("在"),a("code",[t._v("app/extend/application.js")]),t._v("新建一个application扩展")])]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220219210114.png",alt:"image-20220219210113028"}})]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220219210141.png",alt:"image-20220219210140296"}})]),t._v(" "),a("blockquote",[a("p",[t._v("在"),a("code",[t._v("test/app/extend/application.test.js")]),t._v("测试")])]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220219210342.png",alt:"image-20220219210341123"}})]),t._v(" "),a("h3",{attrs:{id:"测试context"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#测试context"}},[t._v("#")]),t._v(" 测试Context")]),t._v(" "),a("blockquote",[a("p",[t._v("使用我们之前写的上下文的扩展 统一接口响应格式")])]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220219210435.png",alt:"image-20220219210434092"}})]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220219210445.png",alt:"image-20220219210444581"}})]),t._v(" "),a("blockquote",[a("p",[t._v("在"),a("code",[t._v("test/app/extend/context.test.js")]),t._v("测试")])]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220219210701.png",alt:"image-20220219210659768"}})]),t._v(" "),a("h3",{attrs:{id:"测试request"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#测试request"}},[t._v("#")]),t._v(" 测试Request")]),t._v(" "),a("blockquote",[a("p",[t._v("在"),a("code",[t._v("app/extend/request.js")]),t._v("新建一个扩展")])]),t._v(" "),a("p",[t._v("就判断请求的客户端是否是Chrome")]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220219210751.png",alt:"image-20220219210750058"}})]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220219210810.png",alt:"image-20220219210809433"}})]),t._v(" "),a("blockquote",[a("p",[t._v("在"),a("code",[t._v("test/app/extend/request.test.js")]),t._v("测试")])]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220219211018.png",alt:"image-20220219211016960"}})]),t._v(" "),a("h3",{attrs:{id:"测试response"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#测试response"}},[t._v("#")]),t._v(" 测试Response")]),t._v(" "),a("blockquote",[a("p",[t._v("在"),a("code",[t._v("app/extend/response.js")]),t._v("新建一个扩展")])]),t._v(" "),a("p",[t._v("就判断响应是否成功")]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220219211126.png",alt:"image-20220219211125730"}})]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220219211145.png",alt:"image-20220219211144314"}})]),t._v(" "),a("blockquote",[a("p",[t._v("在"),a("code",[t._v("test/app/extend/response.test.js")]),t._v("测试")])]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220219211300.png",alt:"image-20220219211259124"}})]),t._v(" "),a("h3",{attrs:{id:"测试helper"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#测试helper"}},[t._v("#")]),t._v(" 测试Helper")]),t._v(" "),a("blockquote",[a("p",[t._v("在"),a("code",[t._v("app/extend/helper.js")]),t._v("新建一个扩展")])]),t._v(" "),a("p",[t._v("上次写的工具类的加密")]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220219211425.png",alt:"image-20220219211424009"}})]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220219211444.png",alt:"image-20220219211443794"}})]),t._v(" "),a("blockquote",[a("p",[t._v("在"),a("code",[t._v("test/app/extend/helper.test.js")]),t._v("测试")])]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220219211625.png",alt:"image-20220219211624475"}})]),t._v(" "),a("h3",{attrs:{id:"测试定时任务"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#测试定时任务"}},[t._v("#")]),t._v(" 测试定时任务")]),t._v(" "),a("blockquote",[a("p",[t._v("在"),a("code",[t._v("app/schedule/updateMessage.js")])])]),t._v(" "),a("p",[t._v("上次写的定时任务每隔十秒让count++并赋值给了ctx.app.msg")]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220219211827.png",alt:"image-20220219211826521"}})]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220219212254.png",alt:"image-20220219212253059"}})]),t._v(" "),a("blockquote",[a("p",[t._v("在"),a("code",[t._v("test/app/schedule/updateMessage.test.js")]),t._v("测试")])]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220219212029.png",alt:"image-20220219212027998"}})]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220219212222.png",alt:"image-20220219212221251"}})]),t._v(" "),a("h3",{attrs:{id:"生成测试报告"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#生成测试报告"}},[t._v("#")]),t._v(" 生成测试报告")]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220219212402.png",alt:"image-20220219212401297"}})]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("npm")]),t._v(" run cov\n")])])]),a("blockquote",[a("p",[t._v("运行完毕之后再项目根目录生成了coverage目录")])]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220219212443.png",alt:"image-20220219212442396"}})]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220219212653.png",alt:"image-20220219212651694"}})]),t._v(" "),a("p",[a("img",{attrs:{src:"http://r9cclbbs3.hn-bkt.clouddn.com/20220219212558.png",alt:"image-20220219212557481"}})])])}),[],!1,null,null,null);s.default=e.exports}}]);